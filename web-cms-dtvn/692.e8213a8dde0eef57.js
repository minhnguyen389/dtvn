"use strict";(self.webpackChunkweb_cms_dtvn=self.webpackChunkweb_cms_dtvn||[]).push([[692],{9692:(q,d,a)=>{a.r(d),a.d(d,{StatusLogModule:()=>Q});var c=a(9808),u=a(8753),t=a(5e3),h=a(6675),f=a(1764),s=a.n(f),T=a(5268),v=a.n(T),C=a(4416),S=a(1484),p=a(9783),P=a(5330),y=a(5431),M=a(8386),g=a(8952),m=a(2382),L=a(1424),x=a(845),Z=a(5787),E=a(4036),b=a(4119),D=a(5077),w=a(4132);const A=["divTable"],O=["divPaginator"],_=function(){return{applyLabel:"Ch\u1ecdn",clearLabel:"X\xf3a",format:"HH:mm DD/MM/YYYY",separator:" \u0111\u1ebfn "}};function H(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",17)(1,"div",18)(2,"div",19)(3,"input",20),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().station_name=i}),t.qZA(),t.TgZ(4,"button",21),t.NdJ("click",function(){return t.CHM(e),t.oxw().onPickStation()}),t.qZA()()(),t.TgZ(5,"div",18)(6,"p-dropdown",22),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().status=i}),t.qZA()(),t.TgZ(7,"div",18)(8,"input",23),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().rangeTimes=i}),t.qZA()(),t.TgZ(9,"div",24)(10,"div",25)(11,"span")(12,"button",26),t.NdJ("click",function(){return t.CHM(e),t.oxw().onClear()}),t.qZA(),t.TgZ(13,"button",27),t.NdJ("click",function(){return t.CHM(e),t.oxw().onSearch()}),t.qZA()()()()()}if(2&o){const e=t.oxw();t.xp6(3),t.Q6J("ngModel",e.station_name),t.xp6(3),t.Q6J("options",e.statusOption)("ngModel",e.status),t.xp6(2),t.Q6J("showDropdowns",!0)("locale",t.DdM(13,_))("showClearButton",!0)("timePicker",!0)("timePicker24Hour",!0)("dateLimit",93)("ngModel",e.rangeTimes)("ranges",e.ranges)("alwaysShowCalendars",!0),t.xp6(5),t.Q6J("disabled",!e.rangeTimes||e.rangeTimes&&!e.rangeTimes.startDate&&!e.rangeTimes.endDate)}}function J(o,r){1&o&&(t.TgZ(0,"tr")(1,"th",28),t._uU(2,"#"),t.qZA(),t.TgZ(3,"th",29),t._uU(4,"Tr\u1ea1m"),t.qZA(),t.TgZ(5,"th",29),t._uU(6,"M\xe3"),t.qZA(),t.TgZ(7,"th",29),t._uU(8,"Tr\u1ea1ng th\xe1i"),t.qZA(),t.TgZ(9,"th",30),t._uU(10,"Th\u1eddi gian t\u1ea1o "),t._UZ(11,"p-sortIcon",31),t.qZA()())}const B=function(o){return{"background-color":o}};function F(o,r){if(1&o&&(t.TgZ(0,"tr")(1,"td",28),t._uU(2),t.qZA(),t.TgZ(3,"td",29),t._uU(4),t.qZA(),t.TgZ(5,"td",29),t._uU(6),t.qZA(),t.TgZ(7,"td",29)(8,"span",32),t._uU(9),t.qZA()(),t.TgZ(10,"td",33),t._uU(11),t.qZA()()),2&o){const e=r.$implicit,n=r.rowIndex,i=t.oxw();t.xp6(2),t.Oqu((i.currentPage-1)*i.itemsPerPage+1+n),t.xp6(2),t.Oqu(e.station.name),t.xp6(2),t.Oqu(e.code),t.xp6(2),t.Q6J("ngStyle",t.VKq(6,B,e.status?"green":"red")),t.xp6(1),t.Oqu(e.status?"Online":"Offline"),t.xp6(2),t.Oqu(i.convertTime(e.created_at))}}function U(o,r){1&o&&(t.TgZ(0,"div",34),t._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. H\xe3y ch\u1ecdn c\xe1c \u0111i\u1ec1u ki\u1ec7n ph\xf9 h\u1ee3p v\xe0 T\xecm ki\u1ebfm. "),t.qZA())}const Y=function(){return[15,20,30,50]};s().extend(v());const I=[{path:"",component:(()=>{class o{constructor(e,n,i,l,z,j,k){this.logHttpService=e,this.messageService=n,this.renderer=i,this.dialogService=l,this.permissionService=z,this.router=j,this.userService=k,this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.statusLogs=[],this.statusOption=[{name:"T\u1ea5t c\u1ea3",value:void 0},{name:"Online",value:!0},{name:"Offline",value:!1}],this.loading=!1,this.ranges={"H\xf4m nay":[s()().startOf("dates"),s()().endOf("dates")],"H\xf4m qua":[s()().subtract(1,"days").startOf("dates"),s()().subtract(1,"days").endOf("dates")],"7 ng\xe0y g\u1ea7n nh\u1ea5t":[s()().subtract(6,"days").startOf("dates"),s()().endOf("dates")],"Th\xe1ng n\xe0y":[s()().startOf("month"),s()().endOf("month")],"3 th\xe1ng g\u1ea7n nh\u1ea5t":[s()().subtract(2,"month").startOf("month"),s()().endOf("month")],"6 th\xe1ng g\u1ea7n nh\u1ea5t":[s()().subtract(5,"month").startOf("month"),s()().endOf("month")]}}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime)}setStyleDiv(){this.renderer.setStyle(this.divTable.nativeElement,"bottom",`  ${this.divPaginator.nativeElement.offsetHeight}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}ngOnInit(){this.user=this.userService.getMyAccount(),this.subPermission=this.permissionService.currentPermission.subscribe(e=>{e&&(this.permission=e),3!==this.user.user_group&&(this.startDate=s()().subtract(1,"years").startOf("dates").utc().format(),this.endDate=s()().endOf("dates").utc().format(),this.fetchListOfStatusLogs())})}fetchListOfStatusLogs(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.logHttpService.getListStatusLogs(this.station_id,this.status,this.startDate,this.endDate,this.itemsPerPage,this.offset).subscribe({next:e=>{200===e.status?(console.log("fetchListOfStatusLogs",e),this.statusLogs=e.metadata.docs,this.totalItems=e.metadata.totalDocs,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${e.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",e.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:e=>{let n;n=e&&e.error&&e.error.message?e.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:n}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",e),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}onPageChange(e){this.currentPage=e.page+1,this.itemsPerPage=e.rows,this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchListOfStatusLogs()}onReSync(){this.fetchListOfStatusLogs()}convertTime(e){return h.I.isoToVnTime(e)}formatCurrency(e){return new Intl.NumberFormat("en-US").format(e)}onGoBackHome(){this.router.navigate(["/"])}onClear(){this.startDate=void 0,this.endDate=void 0,this.rangeTimes=void 0,this.station_name=void 0,this.station_id=void 0,this.status=void 0}onSearch(){this.startDate=this.rangeTimes&&this.rangeTimes.startDate?s().utc(this.rangeTimes.startDate).subtract(7,"hours").format():null,this.endDate=this.rangeTimes&&this.rangeTimes.endDate?s().utc(this.rangeTimes.endDate).subtract(7,"hours").format():null,this.fetchListOfStatusLogs()}onPickStation(){this.dialogService.open(C.L,{showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(n=>{n&&(this.station_name=n.name,this.station_id=n._id)})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(S.m),t.Y36(p.ez),t.Y36(t.Qsj),t.Y36(P.xA),t.Y36(y.$),t.Y36(u.F0),t.Y36(M.K))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-status-log-management"]],viewQuery:function(e,n){if(1&e&&(t.Gf(A,5,t.SBq),t.Gf(O,5,t.SBq)),2&e){let i;t.iGM(i=t.CRH())&&(n.divTable=i.first),t.iGM(i=t.CRH())&&(n.divPaginator=i.first)}},decls:18,vars:12,consts:[[1,"relative","h-full","w-full",3,"resize"],[1,"absolute","top-0","left-0","w-full"],["divTable",""],["styleClass","p-datatable-sm","scrollHeight","flex",3,"value","scrollable","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"absolute","bottom-0","left-0","w-full","border-top-1","border-gray-300"],["divPaginator",""],[1,"grid","grid-nogutter"],[1,"col-12","md:col-5","flex","align-items-center"],[1,"col-12","md:col-5","flex","align-items-center","justify-content-end"],["styleClass","p-0",3,"rows","totalRecords","rowsPerPageOptions","showJumpToPageDropdown","showPageLinks","onPageChange"],[1,"col-12","md:col-2","flex","align-items-center"],["pButton","","pRipple","","type","button","icon","fa-solid fa-sync",1,"p-button-raised","p-button-text","m-0",3,"click"],[1,"ml-1"],[1,"p-fluid","grid","formgrid"],[1,"field","col-12","md:col-3","mb-1"],[1,"p-inputgroup"],["type","text","pInputText","","placeholder","Ch\u1ecdn Tr\u1ea1m","disabled","",3,"ngModel","ngModelChange"],["type","button","pButton","","pRipple","","icon","pi pi-ellipsis-h",3,"click"],["optionLabel","name","optionValue","value","placeholder","Ch\u1ecdn lo\u1ea1i b\u1ea3n tin","panelStyleClass","text-overflow-ellipsis text-sm","pTooltip","Ch\u1ecdn tr\u1ea1ng th\xe1i","tooltipPosition","top",3,"options","ngModel","ngModelChange"],["type","text","pInputText","","placeholder","Ch\u1ecdn kho\u1ea3ng th\u1eddi gian","ngxDaterangepickerMd","",1,"w-full",3,"showDropdowns","locale","showClearButton","timePicker","timePicker24Hour","dateLimit","ngModel","ranges","alwaysShowCalendars","ngModelChange"],[1,"field","col-12","md:col-3"],[1,"flex","justify-content-between"],["type","button","pButton","","icon","fa-solid fa-undo","pTooltip","\u0110\u1eb7t l\u1ea1i","tooltipPosition","top",1,"mr-1",3,"click"],["type","button","pButton","","icon","fa-solid fa-search","pTooltip","T\xecm ki\u1ebfm","tooltipPosition","top",1,"mr-1",3,"disabled","click"],[2,"width","60px","max-width","60px"],[2,"min-width","100px"],["pSortableColumn","created_at",2,"width","200px","max-width","200px"],["field","created_at"],[1,"m-0","py-1","px-2","text-white","border-round-sm",3,"ngStyle"],[2,"width","200px","max-width","200px"],[1,"p-fluid","p-2"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.NdJ("resize",function(){return n.onWindowResize()},!1,t.Jf7),t.TgZ(1,"div",1,2)(3,"p-table",3),t.YNc(4,H,14,14,"ng-template",4),t.YNc(5,J,12,0,"ng-template",5),t.YNc(6,F,12,8,"ng-template",6),t.YNc(7,U,2,0,"ng-template",7),t.qZA()(),t.TgZ(8,"div",8,9)(10,"div",10),t._UZ(11,"div",11),t.TgZ(12,"div",12)(13,"p-paginator",13),t.NdJ("onPageChange",function(l){return n.onPageChange(l)}),t.qZA()(),t.TgZ(14,"div",14)(15,"button",15),t.NdJ("click",function(){return n.onReSync()}),t.qZA(),t.TgZ(16,"span",16),t._uU(17),t.qZA()()()()()),2&e&&(t.xp6(3),t.Q6J("value",n.statusLogs)("scrollable",!0)("loading",n.loading),t.xp6(10),t.Q6J("rows",n.itemsPerPage)("totalRecords",n.totalItems)("rowsPerPageOptions",t.DdM(11,Y))("showJumpToPageDropdown",!0)("showPageLinks",!1),t.xp6(4),t.lnq("Hi\u1ec3n th\u1ecb ",(n.currentPage-1)*n.itemsPerPage+1,"-",(n.currentPage-1)*n.itemsPerPage+n.itemsPerPage>n.totalItems?n.totalItems:(n.currentPage-1)*n.itemsPerPage+n.itemsPerPage,"/",n.totalItems,""))},directives:[g.iA,p.jx,m.Fj,L.o,m.JJ,m.On,x.Hq,Z.H,E.Lt,b.u,D.SP,g.lQ,g.fz,c.PC,w.D],styles:[""]}),o})()}];let N=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[u.Bz.forChild(I)],u.Bz]}),o})();var R=a(8910);let Q=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[c.ez,N,R.m]]}),o})()}}]);