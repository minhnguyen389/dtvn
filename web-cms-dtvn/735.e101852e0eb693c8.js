(self.webpackChunkweb_cms_dtvn=self.webpackChunkweb_cms_dtvn||[]).push([[735],{4735:(B,E,a)=>{"use strict";a.r(E),a.d(E,{StationModule:()=>Ge});var l=a(9808),m=a(8753),t=a(5e3),f=a(6675),O=a(535),p=a(2382),v=a(8215),y=a(8407),h=(a(2491),a(5330)),g=a(9783),C=a(845),b=a(5787);const Q=["divBound"],G=["divHeader"],j=["divMap"];let $=(()=>{class o{constructor(e,i,n,r){this.ref=e,this.config=i,this.renderer=n,this.messageService=r,this.lat=21.02875408236182,this.lng=105.84141118754117}setStyleDiv(){this.renderer.setStyle(this.divMap.nativeElement,"height",`  ${this.divBound.nativeElement.offsetHeight-this.divHeader.nativeElement.offsetHeight}px`)}ngAfterViewInit(){this.setStyleDiv(),this.initMap()}ngAfterViewChecked(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}ngOnInit(){this.config.data&&(this.config.data.lat&&(this.lat=this.config.data.lat),this.config.data.lng&&(this.lng=this.config.data.lng))}initMap(){this.leafletMap&&this.leafletMap.remove(),this.leafletMap=null;let e=y.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'});this.leafletMap=y.map("pick-map",{center:[this.lat,this.lng],zoom:v.o.MAP_ZOOM_INIT,layers:[e],attributionControl:!1}),y.control.scale().addTo(this.leafletMap).setPosition("bottomright"),this.leafletMap.zoomControl.setPosition("bottomright");var i=y.icon({iconUrl:"/assets/b.png",iconSize:[24,24],iconAnchor:[12,12]});this.marker=y.marker([this.lat,this.lng],{icon:i,draggable:!0}).addTo(this.leafletMap),this.marker.on("dragend",n=>{let r=n.target;this.lat=r.getLatLng().lat,this.lng=r.getLatLng().lng,this.leafletMap.panTo([this.lat,this.lng])}),y.easyButton("fa-solid fa-location-crosshairs",(n,r)=>this.getCurrentPosition()).addTo(this.leafletMap).setPosition("bottomright")}onDestroy(){this.ref.destroy()}getCurrentPosition(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{this.lat=e.coords.latitude,this.lng=e.coords.longitude,this.leafletMap.flyTo([this.lat,this.lng],15),this.marker.setLatLng([this.lat,this.lng])},e=>{switch(e.code){case e.PERMISSION_DENIED:this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Quy\u1ec1n truy c\u1eadp v\u1ecb tr\xed b\u1ecb t\u1eeb ch\u1ed1i. C\u1ea7n cho ph\xe9p \u0111\u1ec3 m\u1edf l\u1ea1i quy\u1ec1n truy c\u1eadp"});break;case e.POSITION_UNAVAILABLE:this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"V\u1ecb tr\xed kh\xf4ng s\u1eb5n s\xe0ng"});break;case e.TIMEOUT:this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Th\u1eddi gian l\u1ea5y t\u1ecda \u0111\u1ed9 qu\xe1 l\xe2u"})}},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Tr\xecnh duy\u1ec7t kh\xf4ng h\u1ed7 tr\u1ee3 l\u1ea5y t\u1ecda \u0111\u1ed9 \u0111\u1ecba l\xfd"})}onSubmit(){this.ref.close({lat:this.lat,lng:this.lng})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(h.E7),t.Y36(h.S),t.Y36(t.Qsj),t.Y36(g.ez))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-pick-location"]],viewQuery:function(e,i){if(1&e&&(t.Gf(Q,5,t.SBq),t.Gf(G,5,t.SBq),t.Gf(j,5,t.SBq)),2&e){let n;t.iGM(n=t.CRH())&&(i.divBound=n.first),t.iGM(n=t.CRH())&&(i.divHeader=n.first),t.iGM(n=t.CRH())&&(i.divMap=n.first)}},decls:16,vars:2,consts:[[1,"relative","w-full","h-full"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["divHeader",""],[1,"flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","text-xl","font-bold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[1,"absolute","bottom-0","left-0","w-full"],["divMap",""],["id","pick-map"],["id","latlng",1,"border-1","border-gray-400"],["id","foo-btn",1,"flex","align-items-center","justify-content-end","border-top-1","border-gray-300"],["pButton","","pRipple","","type","button","label","H\u1ee7y b\u1ecf","icon","fa-solid fa-times",1,"p-button-outlined","mr-1",3,"click"],["pButton","","pRipple","","type","button","label","Ch\u1ecdn","icon","fa-solid fa-check",1,"mr-1",3,"click"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0,1)(2,"div",2,3)(4,"div",4)(5,"span",5),t._uU(6,"Ch\u1ecdn v\u1ecb tr\xed tr\xean b\u1ea3n \u0111\u1ed3"),t.qZA(),t.TgZ(7,"button",6),t.NdJ("click",function(){return i.onDestroy()}),t.qZA()()(),t.TgZ(8,"div",7,8),t._UZ(10,"div",9),t.TgZ(11,"div",10),t._uU(12),t.qZA(),t.TgZ(13,"div",11)(14,"button",12),t.NdJ("click",function(){return i.onDestroy()}),t.qZA(),t.TgZ(15,"button",13),t.NdJ("click",function(){return i.onSubmit()}),t.qZA()()()()),2&e&&(t.xp6(12),t.AsE("(",i.lat,",",i.lng,")"))},directives:[C.Hq,b.H],styles:["#pick-map[_ngcontent-%COMP%]{position:absolute;top:0;bottom:70px;width:100%}#foo-btn[_ngcontent-%COMP%]{position:absolute;bottom:0;height:45px;width:100%}#latlng[_ngcontent-%COMP%]{position:absolute;bottom:45px;height:25px;padding:auto;width:100%;text-align:center}"]}),o})();var T=a(1489),q=a(8386),Z=a(1424),H=a(3407),z=a(7010),M=a(4036),V=a(2537);function W(o,s){1&o&&(t.TgZ(0,"div"),t._uU(1," *C\u1ea7n \u0111i\u1ec1n t\xean tr\u1ea1m."),t.qZA())}function K(o,s){1&o&&(t.TgZ(0,"div"),t._uU(1," *T\xean tr\u1ea1m d\xe0i \xedt nh\u1ea5t 2 k\xfd t\u1ef1."),t.qZA())}function tt(o,s){if(1&o&&(t.TgZ(0,"small",28),t.YNc(1,W,2,0,"div",29),t.YNc(2,K,2,0,"div",29),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.formGroup.controls.name.invalid),t.xp6(1),t.Q6J("ngIf",e.formGroup.controls.name.errors.minlength)}}function et(o,s){1&o&&(t.TgZ(0,"div"),t._uU(1," *C\u1ea7n ch\u1ecdn lo\u1ea1i thi\u1ebft b\u1ecb."),t.qZA())}function it(o,s){if(1&o&&(t.TgZ(0,"small",28),t.YNc(1,et,2,0,"div",29),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.formGroup.controls.device_type.invalid)}}function nt(o,s){1&o&&(t.TgZ(0,"div"),t._uU(1," *C\u1ea7n \u0111i\u1ec1n \u0111\u1ecba ch\u1ec9 thi\u1ebft b\u1ecb (MAC address)."),t.qZA())}function ot(o,s){if(1&o&&(t.TgZ(0,"small",28),t.YNc(1,nt,2,0,"div",29),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.formGroup.controls.code.invalid)}}function st(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",7)(1,"label",30),t._uU(2,"C\xf4ng tr\xecnh "),t.TgZ(3,"span",9),t._uU(4,"(*)"),t.qZA()(),t.TgZ(5,"div",31),t._UZ(6,"input",32),t.TgZ(7,"button",33),t.NdJ("click",function(){return t.CHM(e),t.oxw().onPickProject()}),t.qZA()()()}if(2&o){const e=t.oxw();t.xp6(6),t.Q6J("value",null!=e.formGroup.controls.project.value&&e.formGroup.controls.project.value.name?e.formGroup.controls.project.value.name:"Ch\u1ecdn c\xf4ng tr\xecnh"),t.xp6(1),t.Q6J("disabled",e.station)}}let I=(()=>{class o{constructor(e,i,n,r,c,u,d){this.ref=e,this.config=i,this.formBuilder=n,this.sHttpService=r,this.messageService=c,this.dialogService=u,this.userService=d,this.title="Th\xeam m\u1edbi tr\u1ea1m",this.deviceTypeOption=v.o.deviceTypeOption}ngOnInit(){this.user=this.userService.getMyAccount(),this.formGroup=this.formBuilder.group({name:["",[p.kI.required,p.kI.minLength(2)]],description:[],code:["",[p.kI.required]],project:["",[p.kI.required]],latitude:[],longitude:[],device_type:["",[p.kI.required]]}),1==this.user.user_group&&this.formGroup.controls.project.disable(),this.config.data&&(this.title=this.config.data.title,this.station=this.config.data.station,this.station&&(this.formGroup.controls.project.disable(),this.formGroup.controls.device_type.disable(),this.formGroup.setValue({name:this.station.name,description:this.station.description?this.station.description:null,code:this.station.code,project:this.station.project,latitude:this.station.latitude?this.station.latitude:null,longitude:this.station.longitude?this.station.longitude:null,device_type:this.station.device_type})))}selectLocation(){this.dialogService.open($,{data:{lat:this.station?this.station.latitude:null,lng:this.station?this.station.longitude:null},showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(i=>{i&&(this.formGroup.controls.latitude.setValue(i.lat),this.formGroup.controls.longitude.setValue(i.lng))})}onPickProject(){this.dialogService.open(O.A,{showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(i=>{i&&this.formGroup.controls.project.setValue(i)})}onSubmit(){this.station?this.onEdit():this.onAdd()}onAdd(){this.sHttpService.create(this.formGroup.value.name,this.formGroup.value.description,this.formGroup.value.code,0===this.user.user_group?this.formGroup.value.project._id:this.user.project_id,this.formGroup.value.latitude,this.formGroup.value.longitude,this.formGroup.value.device_type).subscribe({next:e=>{e&&200===e.status&&(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 t\u1ea1o tr\u1ea1m th\xe0nh c\xf4ng"}),this.ref.close("success"))},error:e=>{let i;i=e&&e.error&&e.error.message?e.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:i}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",e)}})}onEdit(){this.sHttpService.edit(this.station._id,this.formGroup.value.name,this.formGroup.value.description,this.formGroup.value.latitude,this.formGroup.value.longitude,this.formGroup.value.code,null,null,null).subscribe({next:e=>{e&&200===e.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 c\u1eadp nh\u1eadt tr\u1ea1m th\xe0nh c\xf4ng"}),this.ref.close("success")):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Kh\xf4ng t\xecm th\u1ea5y tr\u1ea1m"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",e.message))},error:e=>{let i;i=e&&e.error&&e.error.message?e.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:i}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",e)}})}onDestroy(){this.ref.destroy()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(h.E7),t.Y36(h.S),t.Y36(p.qu),t.Y36(T.P),t.Y36(g.ez),t.Y36(h.xA),t.Y36(q.K))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-create-or-edit-station"]],decls:44,vars:13,consts:[[3,"formGroup","ngSubmit"],[1,"outbound"],[1,"header","flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","text-xl","font-bold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[1,"content"],[1,"p-fluid","m-2"],[1,"field","mb-2"],["for","name"],[1,"ml-2","text-red-500"],["id","name","type","text","pInputText","","formControlName","name"],["class","text-red-500",4,"ngIf"],["for","desc"],["id","desc","pInputTextarea","","formControlName","description",3,"rows"],[1,"field","mb-3"],["for","latlg"],["id","latlg",1,"p-inputgroup"],["formControlName","latitude","mode","decimal","inputId","lat","placeholder","V\u0129 \u0111\u1ed9",3,"minFractionDigits","maxFractionDigits"],["formControlName","longitude","mode","decimal","inputId","long","placeholder","Kinh \u0111\u1ed9",3,"minFractionDigits","maxFractionDigits"],["pButton","","pRipple","","type","button","icon","fa-solid fa-map-location-dot",3,"click"],["for","dtyp"],["id","dtyp","formControlName","device_type","optionLabel","name","placeholder","Ch\u1ecdn lo\u1ea1i thi\u1ebft b\u1ecb","optionValue","value","panelStyleClass","text-overflow-ellipsis text-sm",3,"options"],["for","cod"],["id","cod","mask","************","formControlName","code","characterPattern","[0-9a-f]"],["class","field mb-2",4,"ngIf"],[1,"footer","flex","align-items-center","justify-content-end","border-top-1","border-gray-300"],["pButton","","pRipple","","type","button","label","H\u1ee7y b\u1ecf","icon","fa-solid fa-times",1,"p-button-outlined","mr-1",3,"click"],["pButton","","pRipple","","type","submit","label","L\u01b0u th\xf4ng tin","icon","fa-solid fa-floppy-disk",1,"mr-1",3,"disabled"],[1,"text-red-500"],[4,"ngIf"],["for","con"],["id","con",1,"p-inputgroup"],["type","text","pInputText","","disabled","",3,"value"],["type","button","pButton","","pRipple","","icon","pi pi-ellipsis-h",3,"disabled","click"]],template:function(e,i){1&e&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return i.onSubmit()}),t.TgZ(1,"div",1)(2,"div",2)(3,"span",3),t._uU(4),t.qZA(),t.TgZ(5,"button",4),t.NdJ("click",function(){return i.onDestroy()}),t.qZA()(),t.TgZ(6,"div",5)(7,"div",6)(8,"div",7)(9,"label",8),t._uU(10,"T\xean "),t.TgZ(11,"span",9),t._uU(12,"(*)"),t.qZA()(),t._UZ(13,"input",10),t.YNc(14,tt,3,2,"small",11),t.qZA(),t.TgZ(15,"div",7)(16,"label",12),t._uU(17,"M\xf4 t\u1ea3"),t.qZA(),t._UZ(18,"textarea",13),t.qZA(),t.TgZ(19,"div",14)(20,"label",15),t._uU(21,"T\u1ecda \u0111\u1ed9"),t.qZA(),t.TgZ(22,"div",16),t._UZ(23,"p-inputNumber",17)(24,"p-inputNumber",18),t.TgZ(25,"button",19),t.NdJ("click",function(){return i.selectLocation()}),t.qZA()()(),t.TgZ(26,"div",7)(27,"label",20),t._uU(28,"Lo\u1ea1i thi\u1ebft b\u1ecb s\u1eed d\u1ee5ng "),t.TgZ(29,"span",9),t._uU(30,"(*)"),t.qZA()(),t._UZ(31,"p-dropdown",21),t.YNc(32,it,2,1,"small",11),t.qZA(),t.TgZ(33,"div",7)(34,"label",22),t._uU(35,"\u0110\u1ecba ch\u1ec9 thi\u1ebft b\u1ecb (MAC address)"),t.TgZ(36,"span",9),t._uU(37,"(*)"),t.qZA()(),t._UZ(38,"p-inputMask",23),t.YNc(39,ot,2,1,"small",11),t.qZA(),t.YNc(40,st,8,2,"div",24),t.qZA()(),t.TgZ(41,"div",25)(42,"button",26),t.NdJ("click",function(){return i.onDestroy()}),t.qZA(),t._UZ(43,"button",27),t.qZA()()()),2&e&&(t.Q6J("formGroup",i.formGroup),t.xp6(4),t.Oqu(i.title),t.xp6(10),t.Q6J("ngIf",i.formGroup.controls.name.invalid&&i.formGroup.controls.name.touched),t.xp6(4),t.Q6J("rows",2),t.xp6(5),t.Q6J("minFractionDigits",6)("maxFractionDigits",6),t.xp6(1),t.Q6J("minFractionDigits",6)("maxFractionDigits",6),t.xp6(7),t.Q6J("options",i.deviceTypeOption),t.xp6(1),t.Q6J("ngIf",i.formGroup.controls.device_type.invalid&&i.formGroup.controls.device_type.touched),t.xp6(7),t.Q6J("ngIf",i.formGroup.controls.code.invalid&&i.formGroup.controls.code.touched),t.xp6(1),t.Q6J("ngIf",0===i.user.user_group),t.xp6(3),t.Q6J("disabled",i.formGroup.invalid))},directives:[p._Y,p.JL,p.sg,C.Hq,b.H,p.Fj,Z.o,p.JJ,p.u,l.O5,H.g,z.Rn,M.Lt,V.vy],styles:[".outbound[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0;overflow:hidden}.outbound[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:45px}.outbound[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{position:absolute;top:45px;bottom:45px;left:0;width:100%;overflow:auto}.outbound[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{position:absolute;bottom:0;height:45px;left:0;width:100%}"]}),o})();var S=a(5431),at=a(3542),_=a(8952);function rt(o,s){1&o&&(t.TgZ(0,"tr")(1,"th",4),t._uU(2,"#"),t.qZA(),t.TgZ(3,"th",5),t._uU(4,"Th\xf4ng tin"),t.qZA(),t.TgZ(5,"th",5),t._uU(6,"Chi ti\u1ebft"),t.qZA()())}function lt(o,s){if(1&o&&(t.TgZ(0,"tr")(1,"td",4),t._uU(2),t.qZA(),t.TgZ(3,"td",5),t._uU(4),t.qZA(),t.TgZ(5,"td",5),t._uU(6),t.qZA()()),2&o){const e=s.$implicit,i=s.rowIndex;t.xp6(2),t.Oqu(i+1),t.xp6(2),t.Oqu(e.key),t.xp6(2),t.Oqu(e.value)}}let ct=(()=>{class o{constructor(){this.characteristics=[],this.totalItems=0,this.deviceTypeOption=v.o.deviceTypeOption}ngOnInit(){this.getCharacteristics()}getCharacteristics(){var e;this.totalItems=0;for(const i in this.station)"name"==i?(this.characteristics[this.totalItems]={key:"T\xean",value:this.station[i]},this.totalItems+=1):"description"==i?(this.characteristics[this.totalItems]={key:"M\xf4 t\u1ea3",value:this.station[i]},this.totalItems+=1):"code"==i?(this.characteristics[this.totalItems]={key:"M\xe3 (MAC Address)",value:this.station[i]},this.totalItems+=1):"project"==i?(this.characteristics[this.totalItems]={key:"C\xf4ng tr\xecnh",value:null===(e=this.station[i])||void 0===e?void 0:e.name},this.totalItems+=1):"activated"==i?(this.characteristics[this.totalItems]={key:"Tr\u1ea1ng th\xe1i k\xedch ho\u1ea1t",value:this.station[i]?"\u0110\xe3 k\xedch ho\u1ea1t":"Ch\u01b0a k\xedch ho\u1ea1t"},this.totalItems+=1):"status"==i?(this.characteristics[this.totalItems]={key:"Tr\u1ea1ng th\xe1i k\u1ebft n\u1ed1i",value:this.station[i]?"Online":"Offline"},this.totalItems+=1):"latitude"==i?(this.characteristics[this.totalItems]={key:"T\u1ecda \u0111\u1ed9",value:`${this.station.latitude}, ${this.station.longitude}`},this.totalItems+=1):"device_type"==i?(this.characteristics[this.totalItems]={key:"Lo\u1ea1i thi\u1ebft b\u1ecb s\u1eed d\u1ee5ng",value:this.getDeviceType(this.station[i])},this.totalItems+=1):"created_at"==i?(this.characteristics[this.totalItems]={key:"Th\u1eddi gian t\u1ea1o",value:this.convertTime(this.station[i])},this.totalItems+=1):"updated_at"==i&&(this.characteristics[this.totalItems]={key:"C\u1eadp nh\u1eadt",value:this.convertTime(this.station[i])},this.totalItems+=1)}convertTime(e){return f.I.isoToVnTime(e)}getDeviceType(e){let i=this.deviceTypeOption.find(n=>n.value==e);return i?i.name:e}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-station-info"]],inputs:{station:"station"},decls:4,vars:2,consts:[[1,"absolute","top-0","left-0","bottom-0","right-0"],["styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],[2,"width","60px","max-width","60px"],[2,"min-width","200px"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"p-table",1),t.YNc(2,rt,7,0,"ng-template",2),t.YNc(3,lt,7,3,"ng-template",3),t.qZA()()),2&e&&(t.xp6(1),t.Q6J("value",i.characteristics)("scrollable",!0))},directives:[_.iA,g.jx],styles:[""]}),o})();function U(o,s,e,i,n,r,c){try{var u=o[r](c),d=u.value}catch(je){return void e(je)}u.done?s(d):Promise.resolve(d).then(i,n)}var A=a(655);class pt{constructor(s,e,i){this.options={baudRate:9600,dataBits:8,parity:"none",bufferSize:256,flowControl:"none"},this.controlCharacter="\n",this.keepReading=!0,this.readFunction=s,e&&(this.options=e),i&&(this.controlCharacter=i)}sendData(s){return(0,A.mG)(this,void 0,void 0,function*(){yield this.writer.write(s)})}readLoop(){return(0,A.mG)(this,void 0,void 0,function*(){for(;this.port.readable&&this.keepReading;){const s=new TextDecoderStream;this.readableStreamClosed=this.port.readable.pipeTo(s.writable),this.reader=s.readable.pipeThrough(new TransformStream(new ut(this.controlCharacter))).getReader();try{for(;;){const{value:e,done:i}=yield this.reader.read();if(i)break;e&&this.readFunction(e)}}catch(e){console.error("Read Loop error. Have the serial device been disconnected ? ")}}})}close(s){return(0,A.mG)(this,void 0,void 0,function*(){this.keepReading=!1,this.reader.cancel(),yield this.readableStreamClosed.catch(()=>{}),this.writer.close(),yield this.writableStreamClosed,yield this.port.close(),s(null)})}connect(s){return(0,A.mG)(this,void 0,void 0,function*(){if(this.keepReading=!0,"serial"in navigator){let e=navigator;yield e.serial.getPorts();try{this.port=yield e.serial.requestPort()}catch(r){return void console.error("Requesting port error: "+r)}try{yield this.port.open(this.options)}catch(r){return void console.error("Opening port error: "+r)}const n=new TextEncoderStream;this.writableStreamClosed=n.readable.pipeTo(this.port.writable),this.writer=n.writable.getWriter(),this.readLoop(),s(this.port)}else console.error("This browser does NOT support the Web Serial API")})}}class ut{constructor(s){this.container="",this.container="",this.controlCharacter=s}transform(s,e){this.container+=s;const i=this.container.split(this.controlCharacter);this.container=i.pop(),i.forEach(n=>e.enqueue(n))}flush(s){s.enqueue(this.container)}}class X{static CRC16ModbusHex(s){const e=new Uint16Array([0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448]);let i=65535;for(let n=0;n<s.length;n++)i=65535&(e[255&(i^s[n])]^i>>8);return("0000"+i.toString(16)).slice(-4)}static CalcCRC(s){let e=f.Q.ascii2Hex(s);return X.CRC16ModbusHex(e)}}var ht=a(1764),k=a.n(ht),w=a(4119);function mt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"button",16),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).onCommConnect()}),t.qZA()}}function gt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"button",17),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).onCommDisconnect()}),t.qZA()}}function ft(o,s){if(1&o&&(t.TgZ(0,"div",6),t.YNc(1,mt,1,0,"button",14),t.YNc(2,gt,1,0,"button",15),t.TgZ(3,"small"),t._uU(4),t.qZA()()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!e.serialPort),t.xp6(1),t.Q6J("ngIf",e.serialPort),t.xp6(2),t.hij(" ",e.comm_status_msg,"")}}function _t(o,s){if(1&o&&(t.TgZ(0,"div",18),t._uU(1),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.hij("C\u1ea3nh b\xe1o: ",e.msg,"")}}let vt=(()=>{class o{constructor(e,i,n,r,c){this.ref=e,this.config=i,this.messageService=n,this.dialogService=r,this.sHttpService=c,this.parameters=[],this.title="T\u1ea3i c\u1ea5u h\xecnh xu\u1ed1ng thi\u1ebft b\u1ecb",this.toolOption=v.o.toolOption,this.serialOptions={baudRate:115200,dataBits:8,stopBits:1,parity:"none",bufferSize:256,flowControl:"none"},this.comm_status_msg="Kh\xf4ng k\u1ebft n\u1ed1i",this.invalid=!1,this.msg="",this.portAddress=[]}ngOnInit(){this.config.data.station&&(this.station=this.config.data.station,this.parameters=this.config.data.parameters,this.checkConfig())}checkConfig(){this.invalid=!1,this.msg="";let e="";"Gateway"==this.station.device_type?(!this.station.clients||this.station.clients&&0==this.station.clients.length||!this.station.tcp_server_ip||null==this.station.en_display||null==this.station.en_display)&&(this.msg="Th\xf4ng tin c\u1ea5u h\xecnh kh\xf4ng h\u1ee3p l\u1ec7!",this.invalid=!0):this.parameters.length||(this.msg="Kh\xf4ng c\xf3 th\xf4ng s\u1ed1 c\u1ea5u h\xecnh!",this.invalid=!0),this.parameters.forEach(i=>{"Datalogger_4G"==this.station.device_type||"Datalogger_Lora"==this.station.device_type?(!i.dtype||!i.port||!i.address||!i.ftype||!i.cval||i.dval<0||i.cycle<0||!i.table||!i.params||!i.hmi)&&(e+=i.name+", ",this.msg=`B\u1ed9 c\u1ea5u h\xecnh c\u1ee7a th\xf4ng s\u1ed1 '${e.substring(0,e.length-2)}' kh\xf4ng h\u1ee3p l\u1ec7!`,this.invalid=!0):"Controller_Modbus"==this.station.device_type&&("RS485"!=i.port||!i.address||!i.siren_control)&&(e+=i.name+", ",this.msg=`B\u1ed9 c\u1ea5u h\xecnh c\u1ee7a th\xf4ng s\u1ed1 '${e.substring(0,e.length-2)}' kh\xf4ng h\u1ee3p l\u1ec7!`,this.invalid=!0)}),this.invalid||this.createData()}createData(){if("Gateway"==this.station.device_type){let e=[];this.station.clients&&this.station.clients.length&&this.station.clients.forEach(r=>e.push(r.code)),this.data=JSON.stringify([{mac:this.station.code},{list:e},{server:{IP:this.station.tcp_server_ip,en:this.station.en_display?"1":"0"}}]),this.type="config1"}else if("Datalogger_4G"==this.station.device_type||"Datalogger_Lora"==this.station.device_type){let e=[];e.push({mac:this.station.code}),this.portAddress=[],this.parameters.forEach(n=>{let r=JSON.parse(n.params),c=JSON.parse(n.hmi);for(const d in r)r.hasOwnProperty(d)&&(r[d]=String(r[d]));for(const d in c)c.hasOwnProperty(d)&&(c[d]=String(c[d]));let u={id:n.code,port:"RS485"==n.port?`${n.port}-${n.address}`:`${n.port}${n.address}`,dtype:n.dtype,ftype:n.ftype,cval:n.cval,dval:n.dval.toString(),cycle:n.cycle.toString(),table:this.processXY(n.table),params:r,hmi:c};e.push(u),this.portAddress.push(u.port)}),new Set(this.portAddress).size!==this.portAddress.length&&(this.msg="C\xe1c th\xf4ng s\u1ed1 c\xf3 c\u1ea5u h\xecnh c\u1ed5ng k\u1ebft n\u1ed1i b\u1ecb tr\xf9ng l\u1eb7p!",this.invalid=!0),this.data=JSON.stringify(e),this.type="config0"}else if("Controller_Modbus"==this.station.device_type){let e=[];e.push({mac:this.station.code}),this.parameters.forEach(n=>{let r=JSON.parse(n.siren_control);e.push(r)}),this.data=JSON.stringify(e),this.type="config0"}}processXY(e){console.log(e);let i={};return JSON.parse(e).forEach(r=>{i[r.x.toString()]=r.y.toString()}),i}onSubmit(){if("internet"==this.tool)this.sHttpService.downloadConfig(this.station._id,this.data,this.type,this.station.code).subscribe({next:e=>{e&&200===e.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 t\u1ea3i config xu\u1ed1ng thi\u1ebft b\u1ecb!"}),this.ref.close(e.metadata)):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Kh\xf4ng t\xecm th\u1ea5y tr\u1ea1m"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",e.message))},error:e=>{let i;i=e&&e.error&&e.error.message?e.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:i}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",e)}});else if("rs232"==this.tool){let e=k()().unix(),i=`${this.type}@${e}=${this.data}`,n=X.CalcCRC(i);this.serial.sendData(i+n+";"+"\n"),this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 g\u1eedi config xu\u1ed1ng thi\u1ebft b\u1ecb!"})}}onDestroy(){this.onCommDisconnect(),this.ref.destroy()}onCommConnect(){this.serial=new pt(e=>this.serialDataHandler(e),this.serialOptions,";"),this.serialPort||this.serial.connect(e=>{this.serialPort=e,this.comm_status_msg=`K\u1ebft n\u1ed1i COM: ${this.serialOptions.baudRate}-${this.serialOptions.dataBits}-${this.serialOptions.stopBits}-${this.serialOptions.parity}`,this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 k\u1ebft n\u1ed1i c\u1ed5ng COM th\xe0nh c\xf4ng"})})}onCommDisconnect(){this.serialPort&&this.serial.close(()=>{this.serialPort=null,this.comm_status_msg="Kh\xf4ng k\u1ebft n\u1ed1i",this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 ng\u1eaft k\u1ebft n\u1ed1i c\u1ed5ng COM th\xe0nh c\xf4ng"})})}serialDataHandler(e){"#"==e.substring(0,1)&&51==e.length?this.processLedDataHandler(e):this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"})}processLedDataHandler(e){return function dt(o){return function(){var s=this,e=arguments;return new Promise(function(i,n){var r=o.apply(s,e);function c(d){U(r,i,n,c,u,"next",d)}function u(d){U(r,i,n,c,u,"throw",d)}c(void 0)})}}(function*(){})()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(h.E7),t.Y36(h.S),t.Y36(g.ez),t.Y36(h.xA),t.Y36(T.P))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-download-config"]],decls:16,vars:6,consts:[[1,"outbound"],[1,"header","flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","text-xl","font-bold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[1,"content"],[1,"p-fluid","m-2"],[1,"field","mb-2"],["for","com"],["id","com","optionLabel","name","placeholder","Ch\u1ecdn c\xf4ng c\u1ee5 c\u1ea5u h\xecnh","optionValue","value","panelStyleClass","text-overflow-ellipsis text-sm",3,"options","ngModel","ngModelChange"],["class","field mb-2",4,"ngIf"],["class","field mb-2 text-red-500",4,"ngIf"],[1,"footer","flex","align-items-center","justify-content-end","border-top-1","border-gray-300"],["pButton","","pRipple","","type","button","label","H\u1ee7y b\u1ecf","icon","fa-solid fa-times",1,"p-button-outlined","mr-1",3,"click"],["pButton","","pRipple","","type","button","label","T\u1ea3i xu\u1ed1ng","icon","fa-solid fa-download",1,"mr-1",3,"disabled","click"],["type","button","pButton","","pRipple","","icon","fa-solid fa-link","label","K\u1ebft n\u1ed1i","pTooltip","K\u1ebft n\u1ed1i v\u1edbi c\xf4ng c\u1ee5",3,"click",4,"ngIf"],["type","button","pButton","","pRipple","","icon","fa-solid fa-link-slash","label","Ng\u1eaft k\u1ebft n\u1ed1i","class","p-button-danger","pTooltip","Ng\u1eaft k\u1ebft n\u1ed1i v\u1edbi c\xf4ng c\u1ee5",3,"click",4,"ngIf"],["type","button","pButton","","pRipple","","icon","fa-solid fa-link","label","K\u1ebft n\u1ed1i","pTooltip","K\u1ebft n\u1ed1i v\u1edbi c\xf4ng c\u1ee5",3,"click"],["type","button","pButton","","pRipple","","icon","fa-solid fa-link-slash","label","Ng\u1eaft k\u1ebft n\u1ed1i","pTooltip","Ng\u1eaft k\u1ebft n\u1ed1i v\u1edbi c\xf4ng c\u1ee5",1,"p-button-danger",3,"click"],[1,"field","mb-2","text-red-500"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"span",2),t._uU(3),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return i.onDestroy()}),t.qZA()(),t.TgZ(5,"div",4)(6,"div",5)(7,"div",6)(8,"label",7),t._uU(9,"Ch\u1ecdn c\xf4ng c\u1ee5 c\u1ea5u h\xecnh"),t.qZA(),t.TgZ(10,"p-dropdown",8),t.NdJ("ngModelChange",function(r){return i.tool=r}),t.qZA()(),t.YNc(11,ft,5,3,"div",9),t.YNc(12,_t,2,1,"div",10),t.qZA()(),t.TgZ(13,"div",11)(14,"button",12),t.NdJ("click",function(){return i.onDestroy()}),t.qZA(),t.TgZ(15,"button",13),t.NdJ("click",function(){return i.onSubmit()}),t.qZA()()()),2&e&&(t.xp6(3),t.Oqu(i.title),t.xp6(7),t.Q6J("options",i.toolOption)("ngModel",i.tool),t.xp6(1),t.Q6J("ngIf","rs232"==i.tool||"ble"==i.tool),t.xp6(1),t.Q6J("ngIf",i.msg),t.xp6(3),t.Q6J("disabled",!i.tool||i.invalid||("rs232"==i.tool||"ble"==i.tool)&&!i.serialPort))},directives:[C.Hq,b.H,M.Lt,p.JJ,p.On,l.O5,w.u],styles:[".outbound[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0;overflow:hidden}.outbound[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:45px}.outbound[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{position:absolute;top:45px;bottom:45px;left:0;width:100%;overflow:auto}.outbound[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{position:absolute;bottom:0;height:45px;left:0;width:100%}"]}),o})();var Ct=a(5834),R=a(9269),bt=a(1208),yt=a(5034);const xt=["divBound"],Tt=["divTable"],St=["divPaginator"];function Et(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",10)(1,"label",26),t._uU(2,"Gateway qu\u1ea3n l\xfd:"),t.qZA(),t.TgZ(3,"div",12)(4,"div",27)(5,"p-dropdown",28),t.NdJ("ngModelChange",function(n){return t.CHM(e),t.oxw(2).gateway_id=n})("onChange",function(){return t.CHM(e),t.oxw(2).onChangeInfo()}),t.qZA()()()()}if(2&o){const e=t.oxw(2);t.xp6(5),t.Q6J("options",e.gateways)("ngModel",e.gateway_id)}}function Zt(o,s){1&o&&(t.TgZ(0,"tr")(1,"th",29),t._uU(2,"#"),t.qZA(),t.TgZ(3,"th",30),t._uU(4,"T\xean"),t.qZA(),t.TgZ(5,"th",30),t._uU(6,"\u0110\u1ecba ch\u1ec9"),t.qZA()())}function At(o,s){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.port)}}function wt(o,s){1&o&&(t.TgZ(0,"span"),t._uU(1,"-"),t.qZA())}function Dt(o,s){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.address)}}function Mt(o,s){if(1&o&&(t.TgZ(0,"tr")(1,"td",29),t._uU(2),t.qZA(),t.TgZ(3,"td",30),t._uU(4),t.qZA(),t.TgZ(5,"td",30),t.YNc(6,At,2,1,"span",31),t.YNc(7,wt,2,0,"span",31),t.YNc(8,Dt,2,1,"span",31),t.qZA()()),2&o){const e=s.$implicit,i=s.rowIndex;t.xp6(2),t.Oqu(i+1),t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Q6J("ngIf",e.port),t.xp6(1),t.Q6J("ngIf","RS485"==e.port),t.xp6(1),t.Q6J("ngIf",e.address)}}function Xt(o,s){if(1&o&&(t.TgZ(0,"div",7)(1,"div",8)(2,"p",9),t._uU(3,"Th\xf4ng s\u1ed1 c\u1ea5u h\xecnh "),t.qZA(),t.YNc(4,Et,6,2,"div",20),t.TgZ(5,"div",10)(6,"label",21),t._uU(7,"Danh s\xe1ch c\xe1c th\xf4ng s\u1ed1:"),t.qZA(),t.TgZ(8,"div",12)(9,"div",22)(10,"p-table",23),t.YNc(11,Zt,7,0,"ng-template",24),t.YNc(12,Mt,9,5,"ng-template",25),t.qZA()()()()()()),2&o){const e=t.oxw();t.xp6(4),t.Q6J("ngIf","Datalogger_Lora"==e.station.device_type),t.xp6(6),t.Q6J("value",e.parameters)("scrollable",!0)}}function kt(o,s){1&o&&(t.TgZ(0,"tr")(1,"th",29),t._uU(2,"#"),t.qZA(),t.TgZ(3,"th",30),t._uU(4,"T\xean"),t.qZA(),t.TgZ(5,"th",30),t._uU(6,"\u0110\u1ecba ch\u1ec9"),t.qZA(),t.TgZ(7,"th",40),t._uU(8,"X\xf3a"),t.qZA()())}function Rt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"tr")(1,"td",29),t._uU(2),t.qZA(),t.TgZ(3,"td",30),t._uU(4),t.qZA(),t.TgZ(5,"td",30),t._uU(6),t.qZA(),t.TgZ(7,"td",40)(8,"button",41),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(2).onRemoveClient(r)}),t.qZA()()()}if(2&o){const e=s.$implicit,i=s.rowIndex;t.xp6(2),t.Oqu(i+1),t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.code)}}function Pt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",7)(1,"div",8)(2,"p",9),t._uU(3,"C\u1ea5u h\xecnh cho Gateway "),t.qZA(),t.TgZ(4,"div",10)(5,"label",32),t._uU(6,"Danh s\xe1ch c\xe1c Datalogger:"),t.qZA(),t.TgZ(7,"div",12)(8,"div",22)(9,"p-table",33),t.YNc(10,kt,9,0,"ng-template",24),t.YNc(11,Rt,9,3,"ng-template",25),t.qZA()()()(),t.TgZ(12,"div",10)(13,"label",34),t._uU(14,"\u0110i\u1ec1u khi\u1ec3n hi\u1ec3n th\u1ecb m\xe0n h\xecnh:"),t.qZA(),t.TgZ(15,"div",12)(16,"div",35)(17,"p-checkbox",36),t.NdJ("ngModelChange",function(n){return t.CHM(e),t.oxw().en_display=n})("onChange",function(){return t.CHM(e),t.oxw().onChangeInfo()}),t.qZA(),t.TgZ(18,"label",37),t._uU(19),t.qZA()()()(),t.TgZ(20,"div",10)(21,"label",38),t._uU(22,"\u0110\u1ecba ch\u1ec9 IP c\u1ee7a m\xe0n h\xecnh:"),t.qZA(),t.TgZ(23,"div",12)(24,"div",27)(25,"div",27)(26,"input",39),t.NdJ("ngModelChange",function(n){return t.CHM(e),t.oxw().tcp_server_ip=n})("keyup",function(){return t.CHM(e),t.oxw().checkIp()})("ngModelChange",function(){return t.CHM(e),t.oxw().onChangeInfo()}),t.qZA()()()()()()()}if(2&o){const e=t.oxw();t.xp6(9),t.Q6J("value",e.clients)("scrollable",!0),t.xp6(8),t.Q6J("ngModel",e.en_display)("binary",!0),t.xp6(2),t.hij("(",e.en_display?"Cho ph\xe9p":"Kh\xf4ng cho ph\xe9p",")"),t.xp6(7),t.Q6J("ngClass",e.ip_valid?"ip-ok":"ng-invalid ng-dirty")("ngModel",e.tcp_server_ip)}}function Bt(o,s){1&o&&t._UZ(0,"div",7)}let Ot=(()=>{class o{constructor(e,i,n,r,c,u,d){this.sHttpService=e,this.messageService=i,this.renderer=n,this.permissionService=r,this.pHttpService=c,this.dialogService=u,this.confirmService=d,this.changeInfoEvent=new t.vpe,this.gateways=[],this.parameters=[],this.clients=[],this.toolOption=v.o.toolOption,this.ip_valid=!0,this.en_download=!1,this.loading=!1,this.has_change=!1}ngAfterViewChecked(){this.renderer.setStyle(this.divTable.nativeElement,"height",`  ${this.divBound.nativeElement.offsetHeight-this.divPaginator.nativeElement.offsetHeight}px`)}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe()}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(e=>{e&&(this.permission=e)}),this.getListOfParameters(),this.getListOfGateway(),this.loadConfig(),this.clients=this.station.clients}getListOfParameters(){this.pHttpService.getList(null,null,null,this.station._id,999,0).subscribe({next:e=>{e&&200===e.status&&(this.parameters=e.metadata.docs)},error:e=>{let i;i=e&&e.error&&e.error.message?e.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:i}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",e)}})}getListOfGateway(){this.sHttpService.getList(null,null,this.station.project._id,"Gateway",999999,0).subscribe({next:e=>{e&&200===e.status&&(this.gateways=e.metadata.docs)},error:e=>{let i;i=e&&e.error&&e.error.message?e.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:i}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",e)}})}checkIp(){this.ip_valid=!!/(^\s*((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))\s*$)/i.test(this.tcp_server_ip)}loadConfig(){this.loading=!0,setTimeout(()=>{this.gateway_id=this.station.gateway?this.station.gateway._id:null,this.en_display=!!this.station.en_display,this.tcp_server_ip=this.station.tcp_server_ip?this.station.tcp_server_ip:null,this.loading=!1},500),this.en_download=!0}onSaveConfig(){"Gateway"==this.station.device_type&&!this.ip_valid||this.sHttpService.edit(this.station._id,null,null,null,null,null,this.gateway_id,this.en_display,this.tcp_server_ip).subscribe({next:e=>{e&&200===e.status?(this.station=e.metadata,this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 c\u1eadp nh\u1eadt c\u1ea5u h\xecnh tr\u1ea1m th\xe0nh c\xf4ng"}),this.en_download=!0,this.changeInfoEvent.emit()):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Kh\xf4ng t\xecm th\u1ea5y tr\u1ea1m"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",e.message))},error:e=>{let i;i=e&&e.error&&e.error.message?e.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:i}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",e)}})}onDownload(){this.dialogService.open(vt,{data:{station:this.station,parameters:this.parameters},showHeader:!1,width:"450px",height:"300px",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(i=>{i&&(this.station=i)})}onRemoveClient(e){this.confirmService.confirm({message:`B\u1ea1n c\xf3 mu\u1ed1n x\xf3a Datalogger t\u1ea1i tr\u1ea1m "${e.name}" kh\xf4ng?`,header:"X\xe1c nh\u1eadn x\xf3a Datalogger",icon:"pi pi-info-circle"}).then(i=>{i&&this.sHttpService.removeClient(this.station._id,e._id).subscribe({next:n=>{n&&200===n.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 x\xf3a Datalogger t\u1ea1i tr\u1ea1m tr\u1ea1m (client) th\xe0nh c\xf4ng! C\u1ea7n c\u1eadp nh\u1eadt l\u1ea1i config cho tr\u1ea1m sau khi g\u1ee1 b\u1ecf client!"}),this.getInfo()):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Kh\xf4ng t\xecm th\u1ea5y tr\u1ea1m"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n.message))},error:n=>{let r;r=n&&n.error&&n.error.message?n.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:r}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n)}})}).catch(i=>{})}getInfo(){this.sHttpService.getDetail(this.station._id).subscribe({next:e=>{e&&200===e.status?(this.station=e.metadata,this.clients=this.station.clients):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Kh\xf4ng t\xecm th\u1ea5y tr\u1ea1m"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",e.message))},error:e=>{let i;i=e&&e.error&&e.error.message?e.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:i}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",e)}})}onChangeInfo(){this.en_download=!1,this.has_change=!0}onCancel(){this.loadConfig(),this.has_change=!1,this.en_download=!0}getCfgStatus(e){let i="N/A";return 0==e?i="M\u1edbi":1==e?i="\u0110ang t\u1ea3i":2==e&&(i="\u0110\xe3 t\u1ea3i"),i}getAddress(e,i){let n="";return e&&i&&(n=(e="RS485")?`${e}-${i}`:`${e}${i}`),n}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(T.P),t.Y36(g.ez),t.Y36(t.Qsj),t.Y36(S.$),t.Y36(Ct.v),t.Y36(h.xA),t.Y36(R.I))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-station-config"]],viewQuery:function(e,i){if(1&e&&(t.Gf(xt,5,t.SBq),t.Gf(Tt,5,t.SBq),t.Gf(St,5,t.SBq)),2&e){let n;t.iGM(n=t.CRH())&&(i.divBound=n.first),t.iGM(n=t.CRH())&&(i.divTable=n.first),t.iGM(n=t.CRH())&&(i.divPaginator=n.first)}},inputs:{station:"station"},outputs:{changeInfoEvent:"changeInfoEvent"},decls:31,vars:8,consts:[[1,"absolute","top-0","left-0","bottom-0","right-0"],["divBound",""],[1,"absolute","top-0","left-0","w-full","overflow-auto"],["divTable",""],[1,"grid","grid-nogutter"],[1,"col-12","lg:col-6"],["class","m-1 p-1 mb-2 bg-blue-100 border-round border-1 border-blue-100",4,"ngIf"],[1,"m-1","p-1","mb-2","bg-blue-100","border-round","border-1","border-blue-100"],[1,"bg-white","p-2"],[1,"m-0","mb-2","px-0","pt-0","pb-2","font-bold","border-bottom-1","border-gray-300"],[1,"grid"],[1,"col-12","mb-2","lg:col-4","lg:mb-0"],[1,"col-12","lg:col-8"],[1,"absolute","bottom-0","left-0","p-1","w-full","border-top-1","border-gray-300"],["divPaginator",""],[1,"col-12","flex","align-items-center"],["pButton","","pRipple","","type","button","label","L\u01b0u th\xf4ng tin","icon","fa-solid fa-floppy-disk",1,"mr-1",3,"disabled","click"],["pButton","","pRipple","","type","button","label","H\u1ee7y b\u1ecf","icon","fa-solid fa-times",1,"p-button-outlined","mr-1",3,"click"],["pButton","","pRipple","","type","button","label","T\u1ea3i xu\u1ed1ng","icon","fa-solid fa-download","pTooltip","T\u1ea3i c\u1ea5u h\xecnh xu\u1ed1ng Datalogger","tooltipPosition","top",1,"mr-1",3,"disabled","click"],[3,"show"],["class","grid",4,"ngIf"],["for","dkgs",1,"col-12","mb-2","lg:col-4","lg:mb-0"],[1,"p-1","bg-white"],["id","dkgs","styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],["for","gw",1,"col-12","mb-2","lg:col-4","lg:mb-0"],[1,"p-fluid"],["id","gw","optionLabel","name","optionValue","_id","placeholder","Ch\u1ecdn gateway qu\u1ea3n l\xfd","panelStyleClass","text-overflow-ellipsis text-sm",3,"options","ngModel","ngModelChange","onChange"],[2,"max-width","30px"],[2,"min-width","30px"],[4,"ngIf"],["for","dl",1,"col-12","mb-2","lg:col-4","lg:mb-0"],["id","dl","styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"value","scrollable"],["for","ldisp",1,"col-12","mb-2","lg:col-4","lg:mb-0"],[1,"field-checkbox"],["id","ldisp","inputId","binary",3,"ngModel","binary","ngModelChange","onChange"],["for","binary"],["for","ipdisp",1,"col-12","mb-2","lg:col-4","lg:mb-0"],["id","ipdisp","type","text","pInputText","","placeholder","0.0.0.0",3,"ngClass","ngModel","ngModelChange","keyup"],[2,"max-width","50px"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger",3,"click"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0,1)(2,"div",2,3)(4,"div",4)(5,"div",5),t.YNc(6,Xt,13,3,"div",6),t.YNc(7,Pt,27,7,"div",6),t.YNc(8,Bt,1,0,"div",6),t.TgZ(9,"div",7)(10,"div",8)(11,"p",9),t._uU(12,"Tr\u1ea1ng th\xe1i c\u1ea5u h\xecnh "),t.qZA(),t.TgZ(13,"div",10)(14,"label",11),t._uU(15,"Tr\u1ea1ng th\xe1i c\u1ea5u h\xecnh:"),t.qZA(),t.TgZ(16,"div",12),t._uU(17),t.qZA()(),t.TgZ(18,"div",10)(19,"label",11),t._uU(20,"S\u1ed1 hi\u1ec7u b\u1ea3n tin:"),t.qZA(),t.TgZ(21,"div",12),t._uU(22),t.qZA()()()()()()(),t.TgZ(23,"div",13,14)(25,"div",4)(26,"div",15)(27,"button",16),t.NdJ("click",function(){return i.onSaveConfig()}),t.qZA(),t.TgZ(28,"button",17),t.NdJ("click",function(){return i.onCancel()}),t.qZA(),t.TgZ(29,"button",18),t.NdJ("click",function(){return i.onDownload()}),t.qZA()()()()(),t._UZ(30,"ngx-loading",19)),2&e&&(t.xp6(6),t.Q6J("ngIf","Datalogger_4G"==i.station.device_type||"Datalogger_Lora"==i.station.device_type||"Controller_Modbus"==i.station.device_type||"Controller_DO"==i.station.device_type),t.xp6(1),t.Q6J("ngIf","Gateway"==i.station.device_type),t.xp6(1),t.Q6J("ngIf","PLC"==i.station.device_type),t.xp6(9),t.hij("",i.getCfgStatus(i.station.cfg_status)," "),t.xp6(5),t.Oqu(i.station.cfg_id),t.xp6(5),t.Q6J("disabled",!i.permission.station.edit||"Datalogger_4G"==i.station.device_type||"PLC"==i.station.device_type||!i.has_change),t.xp6(2),t.Q6J("disabled",!i.permission.station.download_config||!i.en_download),t.xp6(1),t.Q6J("show",i.loading))},directives:[l.O5,M.Lt,p.JJ,p.On,_.iA,g.jx,C.Hq,b.H,bt.XZ,p.Fj,Z.o,l.mk,w.u,yt.RJ],styles:[""]}),o})();var qt=a(3037),D=a(97);const Ht=["divBound"],It=["divHeader"],Ut=["divTable"];function Lt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",16)(1,"img",17),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(2).onViewPhoto(r)}),t.qZA()()}if(2&o){const e=s.$implicit,i=t.oxw(2);t.xp6(1),t.Q6J("src",i.getPath(e),t.LSH)}}function Ft(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",2,3),t.NdJ("resize",function(){return t.CHM(e),t.oxw().onWindowResize()},!1,t.Jf7),t.TgZ(2,"div",4,5)(4,"div",6)(5,"span",7),t._uU(6),t.qZA(),t.TgZ(7,"button",8),t.NdJ("click",function(){return t.CHM(e),t.oxw().onDestroy()}),t.qZA()()(),t.TgZ(8,"div",9,10)(10,"label",11)(11,"b"),t._uU(12," N\u1ed9i dung"),t.qZA(),t._uU(13,":"),t.qZA(),t.TgZ(14,"div",12),t._uU(15),t.qZA(),t.TgZ(16,"label",13)(17,"b"),t._uU(18," \u1ea2nh chi ti\u1ebft"),t.qZA(),t._uU(19,":"),t.qZA(),t.TgZ(20,"div",14),t.YNc(21,Lt,2,1,"div",15),t.qZA()()()}if(2&o){const e=t.oxw();t.xp6(6),t.Oqu(e.title),t.xp6(9),t.hij(" ",e.stationRecord.content," "),t.xp6(6),t.Q6J("ngForOf",e.stationRecord.photos)}}function Nt(o,s){1&o&&(t._UZ(0,"i",20),t.TgZ(1,"span",21),t._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),t.qZA())}function Jt(o,s){1&o&&(t.TgZ(0,"p-messages",18),t.YNc(1,Nt,3,0,"ng-template",19),t.qZA())}let Yt=(()=>{class o{constructor(e,i,n,r,c){this.renderer=e,this.permissionService=i,this.ref=n,this.config=r,this.dialogService=c,this.title="Chi ti\u1ebft nh\u1eadt k\xfd"}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe()}setStyleDiv(){this.renderer.setStyle(this.divTable.nativeElement,"height",`  ${this.divBound.nativeElement.offsetHeight-this.divHeader.nativeElement.offsetHeight}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(e=>{e&&(this.permission=e,this.config.data.stationRecord&&(this.stationRecord=this.config.data.stationRecord))})}onDestroy(){this.ref.destroy()}getPath(e){return"assets/placeholder.png"}onViewPhoto(e){this.dialogService.open(qt.p,{data:{photo:e},showHeader:!1,height:"99vh",width:"99vw",contentStyle:{padding:"0",margin:0}})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(t.Qsj),t.Y36(S.$),t.Y36(h.E7),t.Y36(h.S),t.Y36(h.xA))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-station-record-detail"]],viewQuery:function(e,i){if(1&e&&(t.Gf(Ht,5,t.SBq),t.Gf(It,5,t.SBq),t.Gf(Ut,5,t.SBq)),2&e){let n;t.iGM(n=t.CRH())&&(i.divBound=n.first),t.iGM(n=t.CRH())&&(i.divHeader=n.first),t.iGM(n=t.CRH())&&(i.divTable=n.first)}},decls:3,vars:2,consts:[["class","absolute top-0 left-0 bottom-0 right-0",3,"resize",4,"ngIf","ngIfElse"],["noPermission",""],[1,"absolute","top-0","left-0","bottom-0","right-0",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["divHeader",""],[1,"flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","text-xl","font-bold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[1,"absolute","bottom-0","left-0","w-full","p-2"],["divTable",""],["for","cont"],["id","cont",1,"my-2"],["for","pic"],["id","pic",1,"flex","flex-wrap","gap-2","mt-2"],["class","flex align-items-center justify-content-center","style","height: 150px;",4,"ngFor","ngForOf"],[1,"flex","align-items-center","justify-content-center",2,"height","150px"],["alt","construction photo",1,"pointer","shadow-4",2,"height","100%",3,"src","click"],["severity","error"],["pTemplate",""],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(e,i){if(1&e&&(t.YNc(0,Ft,22,3,"div",0),t.YNc(1,Jt,2,0,"ng-template",null,1,t.W1O)),2&e){const n=t.MAs(2);t.Q6J("ngIf",i.permission.project.self)("ngIfElse",n)}},directives:[l.O5,C.Hq,b.H,l.sg,D.V,g.jx],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}.ctmenu[_ngcontent-%COMP%]{position:fixed;z-index:200}.btn[_ngcontent-%COMP%]:hover{background-color:#eff6ff}"]}),o})();var P=a(520),x=a(2340);let F=(()=>{class o{constructor(e){this.http=e}getList(e,i,n,r,c,u){let d=new P.LE;return d=d.append("limit",e),d=d.append("offset",i),r&&(d=d.append("keyword",r)),n&&(d=d.append("station_id",n)),c&&u&&(d=d.append("time_start",c),d=d.append("time_end",u)),this.http.get(`${x.N.url.BASE_URL}/station_record`,{params:d})}getDetail(e){return this.http.get(`${x.N.url.BASE_URL}/station_record/${e}`)}create(e,i,n){const r=new FormData;r.append("station_id",i),r.append("content",e);for(const c of n)r.append("files",c);return this.http.post(`${x.N.url.BASE_URL}/station_record`,r)}edit(e,i,n,r){const c=new FormData;i&&c.append("content",i),n&&n.length&&n.forEach(u=>c.append("photos[]",u));for(const u of r)c.append("files",u);return this.http.put(`${x.N.url.BASE_URL}/station_record/${e}`,c)}delete(e){return this.http.delete(`${x.N.url.BASE_URL}/station_record/${e}`)}approve(e,i){let n=new P.LE;return n=n.append("approval",i),this.http.put(`${x.N.url.BASE_URL}/station_record/${e}/approve`,n)}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(P.eN))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();const Qt=["fileUploader"];function Gt(o,s){1&o&&(t.TgZ(0,"div"),t._uU(1," *C\u1ea7n \u0111i\u1ec1n n\u1ed9i dung nh\u1eadt k\xfd."),t.qZA())}function jt(o,s){if(1&o&&(t.TgZ(0,"small",20),t.YNc(1,Gt,2,0,"div",13),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.formGroup.controls.content.invalid)}}function $t(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",22)(1,"div",23),t._UZ(2,"img",24),t.qZA(),t.TgZ(3,"div",25)(4,"p",26),t._uU(5),t.qZA()(),t.TgZ(6,"span",27)(7,"i",28),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(2).onRemovePhoto(r)}),t.qZA()()()}if(2&o){const e=s.$implicit,i=t.oxw(2);t.xp6(2),t.Q6J("src",i.getPath(e),t.LSH),t.xp6(3),t.Oqu(e)}}function zt(o,s){if(1&o&&(t.TgZ(0,"div"),t.YNc(1,$t,8,2,"div",21),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.photos)}}function Vt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",22)(1,"div",23),t._UZ(2,"img",24),t.qZA(),t.TgZ(3,"div",25)(4,"p",26),t._uU(5),t.qZA()(),t.TgZ(6,"span",27)(7,"i",28),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(2).onRemoveFile(r)}),t.qZA()()()}if(2&o){const e=s.$implicit;t.xp6(2),t.Q6J("src",e.url,t.LSH),t.xp6(3),t.Oqu(e.file.name)}}function Wt(o,s){if(1&o&&(t.TgZ(0,"div"),t.YNc(1,Vt,8,2,"div",21),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.files)}}let N=(()=>{class o{constructor(e,i,n,r,c,u,d){this.ref=e,this.config=i,this.formBuilder=n,this.srHttpService=r,this.messageService=c,this.dialogService=u,this.userService=d,this.title="Th\xeam m\u1edbi nh\u1eadt k\xfd",this.files=[],this.max_file_size=1048576*v.o.MAX_FILE_SIZE_MB,this.photos=[]}ngOnInit(){this.formGroup=this.formBuilder.group({content:[]}),this.user=this.userService.getMyAccount(),this.config.data&&(this.station=this.config.data.station,this.title=this.config.data.title?this.config.data.title:"Th\xeam m\u1edbi nh\u1eadt k\xfd",this.stationRecord=this.config.data.stationRecord,this.stationRecord&&(this.formGroup.setValue({content:this.stationRecord.content}),this.photos=[...this.stationRecord.photos]))}onDestroy(){this.ref.destroy()}onRemoveFile(e){this.files.splice(this.files.indexOf(e),1)}onAttachFile(e){if(e.target.files.length>0){for(const i of e.target.files)if(/\.(jpe?g|png)$/i.test(i.name)&&i.size<=this.max_file_size){const n=new FileReader;n.onload=r=>this.files.push({file:i,url:n.result}),n.readAsDataURL(i)}else this.messageService.add({severity:"warn",summary:"C\u1ea3nh b\xe1o",detail:`File "${i.name}" kh\xf4ng ph\xf9 h\u1ee3p \u0111\u1ecbnh d\u1ea1ng jpg, jpeg, png, ho\u1eb7c file l\u1edbn h\u01a1n ${v.o.MAX_FILE_SIZE_MB}MB`});this.fileUploader.nativeElement.value=""}}onSubmit(){this.stationRecord?this.onEdit():this.onAdd()}onEdit(){let e=[];this.files.forEach(i=>e.push(i.file)),this.srHttpService.edit(this.stationRecord._id,this.formGroup.value.content,this.photos,e).subscribe({next:i=>{i&&200===i.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 c\u1eadp nh\u1eadt nh\u1eadt k\xfd h\u1ea1ng m\u1ee5c th\xe0nh c\xf4ng"}),this.ref.close("success")):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Kh\xf4ng t\xecm th\u1ea5y nh\u1eadt k\xfd!"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{let n;n=i&&i.error&&i.error.message?i.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:n}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}onAdd(){let e=[];this.files.forEach(i=>e.push(i.file)),this.srHttpService.create(this.formGroup.value.content,this.station._id,e).subscribe({next:i=>{i&&200===i.status&&(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 t\u1ea1o nh\u1eadt k\xfd th\xe0nh c\xf4ng"}),this.ref.close("success"))},error:i=>{let n;n=i&&i.error&&i.error.message?i.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:n}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}getPath(e){return"assets/placeholder.png"}onRemovePhoto(e){this.photos.splice(this.photos.indexOf(e),1)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(h.E7),t.Y36(h.S),t.Y36(p.qu),t.Y36(F),t.Y36(g.ez),t.Y36(h.xA),t.Y36(q.K))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-create-or-edit-station-record"]],viewQuery:function(e,i){if(1&e&&t.Gf(Qt,5,t.SBq),2&e){let n;t.iGM(n=t.CRH())&&(i.fileUploader=n.first)}},decls:27,vars:7,consts:[[3,"formGroup","ngSubmit"],[1,"outbound"],[1,"header","flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","text-xl","font-bold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[1,"content"],[1,"p-fluid","m-2"],[1,"field","mb-2"],["for","cont"],[1,"ml-2","text-red-500"],["id","cont","pInputTextarea","","formControlName","content",3,"rows"],["class","text-red-500",4,"ngIf"],[1,"field"],[4,"ngIf"],["type","file","multiple","","accept",".jpg, .jpeg, .png",2,"display","none",3,"change"],["fileUploader",""],["pButton","","pRipple","","type","button","label","Th\xeam \u1ea3nh",1,"mr-1","p-button-outlined",3,"click"],[1,"footer","flex","align-items-center","justify-content-end","border-top-1","border-gray-300"],["pButton","","pRipple","","type","button","label","H\u1ee7y b\u1ecf","icon","fa-solid fa-times",1,"p-button-outlined","mr-1",3,"click"],["pButton","","pRipple","","type","submit","label","L\u01b0u th\xf4ng tin","icon","fa-solid fa-floppy-disk",1,"mr-1",3,"disabled"],[1,"text-red-500"],["class","single-file",4,"ngFor","ngForOf"],[1,"single-file"],[1,"file-icon"],["width","55",2,"cursor","pointer",3,"src"],[1,"info"],[1,"name"],[1,"delete","mx-3"],[1,"pi","pi-trash",3,"click"]],template:function(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return i.onSubmit()}),t.TgZ(1,"div",1)(2,"div",2)(3,"span",3),t._uU(4),t.qZA(),t.TgZ(5,"button",4),t.NdJ("click",function(){return i.onDestroy()}),t.qZA()(),t.TgZ(6,"div",5)(7,"div",6)(8,"div",7)(9,"label",8),t._uU(10,"N\u1ed9i dung "),t.TgZ(11,"span",9),t._uU(12,"(*)"),t.qZA()(),t._UZ(13,"textarea",10),t.YNc(14,jt,2,1,"small",11),t.qZA(),t.TgZ(15,"div",12)(16,"label",8),t._uU(17,"\u1ea2nh chi ti\u1ebft"),t.qZA(),t.YNc(18,zt,2,1,"div",13),t.YNc(19,Wt,2,1,"div",13),t.qZA(),t.TgZ(20,"div",12)(21,"input",14,15),t.NdJ("change",function(c){return i.onAttachFile(c)}),t.qZA(),t.TgZ(23,"button",16),t.NdJ("click",function(){return t.CHM(n),t.MAs(22).click()}),t.qZA()()()(),t.TgZ(24,"div",17)(25,"button",18),t.NdJ("click",function(){return i.onDestroy()}),t.qZA(),t._UZ(26,"button",19),t.qZA()()()}2&e&&(t.Q6J("formGroup",i.formGroup),t.xp6(4),t.Oqu(i.title),t.xp6(9),t.Q6J("rows",5),t.xp6(1),t.Q6J("ngIf",i.formGroup.controls.content.invalid&&i.formGroup.controls.content.touched),t.xp6(4),t.Q6J("ngIf",i.photos&&i.photos.length),t.xp6(1),t.Q6J("ngIf",i.files&&i.files.length),t.xp6(7),t.Q6J("disabled",i.formGroup.invalid||!i.formGroup.value.content))},directives:[p._Y,p.JL,p.sg,C.Hq,b.H,p.Fj,H.g,p.JJ,p.u,l.O5,l.sg],styles:[".outbound[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0;overflow:hidden}.outbound[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:45px}.outbound[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{position:absolute;top:45px;bottom:45px;left:0;width:100%;overflow:auto}.outbound[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{position:absolute;bottom:0;height:45px;left:0;width:100%}.pointer[_ngcontent-%COMP%]{cursor:pointer}.ctmenu[_ngcontent-%COMP%]{position:fixed;z-index:200}.btn[_ngcontent-%COMP%]:hover{background-color:#eff6ff}.single-file[_ngcontent-%COMP%]{display:flex;padding:.1rem;justify-content:space-between;align-items:center;border:dashed 1px #979797;margin-bottom:.2rem}.single-file[_ngcontent-%COMP%]   .delete[_ngcontent-%COMP%]{cursor:pointer;color:red}.single-file[_ngcontent-%COMP%]   .file-icon[_ngcontent-%COMP%]{margin:0;margin-bottom:.25rem;padding:12px}.single-file[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{width:100%}.single-file[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{margin:0;word-break:break-all;white-space:normal}"]}),o})();var Kt=a(5077),J=a(9955),Y=a(4132);const te=["divBound"],ee=["divTable"],ie=["divPaginator"],ne=["fileUploader"],oe=function(){return{applyLabel:"Ch\u1ecdn",clearLabel:"X\xf3a",format:"HH:mm DD/MM/YYYY",separator:" \u0111\u1ebfn "}};function se(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",23)(1,"div",24)(2,"input",25),t.NdJ("ngModelChange",function(n){return t.CHM(e),t.oxw(2).rangeTimes=n}),t.qZA()(),t.TgZ(3,"div",24)(4,"input",26),t.NdJ("ngModelChange",function(n){return t.CHM(e),t.oxw(2).keyword=n}),t.qZA()(),t.TgZ(5,"div",27)(6,"div",28)(7,"span")(8,"button",29),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).onClear()}),t.qZA(),t.TgZ(9,"button",30),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).onSearch()}),t.qZA()()()()()}if(2&o){const e=t.oxw(2);t.xp6(2),t.Q6J("showDropdowns",!0)("locale",t.DdM(8,oe))("showClearButton",!0)("timePicker",!0)("timePicker24Hour",!0)("dateLimit",62)("ngModel",e.rangeTimes),t.xp6(2),t.Q6J("ngModel",e.keyword)}}function ae(o,s){1&o&&(t.TgZ(0,"tr")(1,"th",31),t._uU(2,"#"),t.qZA(),t.TgZ(3,"th",32),t._uU(4,"Th\u1eddi gian "),t._UZ(5,"p-sortIcon",33),t.qZA(),t.TgZ(6,"th",34),t._uU(7,"N\u1ed9i dung"),t.qZA(),t.TgZ(8,"th",35),t._uU(9,"\u1ea2nh"),t.qZA(),t.TgZ(10,"th",36),t._uU(11,"Tr\u1ea1ng th\xe1i"),t.qZA(),t.TgZ(12,"th",36),t._uU(13,"Ng\u01b0\u1eddi t\u1ea1o"),t.qZA()())}function re(o,s){1&o&&(t.TgZ(0,"span",41),t._uU(1,"\u0110\xe3 ph\xea duy\u1ec7t"),t.qZA())}function le(o,s){1&o&&(t.TgZ(0,"span",42),t._uU(1,"Ch\u01b0a ph\xea duy\u1ec7t"),t.qZA())}function ce(o,s){if(1&o&&(t.TgZ(0,"tr",37)(1,"td",31),t._uU(2),t.qZA(),t.TgZ(3,"td",36),t._uU(4),t.qZA(),t.TgZ(5,"td",34),t._uU(6),t.qZA(),t.TgZ(7,"td",35),t._UZ(8,"img",38),t.qZA(),t.TgZ(9,"td",36),t.YNc(10,re,2,0,"span",39),t.YNc(11,le,2,0,"span",40),t.qZA(),t.TgZ(12,"td",36),t._uU(13),t.qZA()()),2&o){const e=s.$implicit,i=s.rowIndex,n=t.oxw(2);t.Q6J("pSelectableRow",e),t.xp6(2),t.Oqu((n.currentPage-1)*n.itemsPerPage+1+i),t.xp6(2),t.Oqu(n.convertTime(e.created_at)),t.xp6(2),t.Oqu(e.content),t.xp6(2),t.Q6J("src","assets/placeholder.png",t.LSH),t.xp6(2),t.Q6J("ngIf",e.approval),t.xp6(1),t.Q6J("ngIf",!e.approval),t.xp6(2),t.Oqu(null==e.created_by?null:e.created_by.username)}}function de(o,s){1&o&&(t.TgZ(0,"div",43),t._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. "),t.qZA())}function pe(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"p-splitButton",44),t.NdJ("onClick",function(){return t.CHM(e),t.oxw(2).onViewDetail()}),t.qZA()}if(2&o){const e=t.oxw(2);t.Q6J("showTransitionOptions","200ms")("hideTransitionOptions","200ms")("model",e.moreCommands)("disabled",!e.currentStationRecord)}}const ue=function(){return[15,20,30,50]};function he(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",2,3),t.NdJ("resize",function(){return t.CHM(e),t.oxw().onWindowResize()},!1,t.Jf7),t.TgZ(2,"div",4,5)(4,"p-table",6),t.NdJ("selectionChange",function(n){return t.CHM(e),t.oxw().currentStationRecord=n})("onRowSelect",function(n){return t.CHM(e),t.oxw().onRowSelect(n)})("onRowUnselect",function(n){return t.CHM(e),t.oxw().onRowUnselect(n)}),t.YNc(5,se,10,9,"ng-template",7),t.YNc(6,ae,14,0,"ng-template",8),t.YNc(7,ce,14,8,"ng-template",9),t.YNc(8,de,2,0,"ng-template",10),t.qZA()(),t.TgZ(9,"div",11,12)(11,"div",13)(12,"div",14)(13,"button",15),t.NdJ("click",function(){return t.CHM(e),t.oxw().onAdd()}),t.qZA(),t.TgZ(14,"button",16),t.NdJ("click",function(){return t.CHM(e),t.oxw().onEdit()}),t.qZA(),t.YNc(15,pe,1,4,"p-splitButton",17),t.qZA(),t.TgZ(16,"div",18)(17,"p-paginator",19),t.NdJ("onPageChange",function(n){return t.CHM(e),t.oxw().onPageChange(n)}),t.qZA()(),t.TgZ(18,"div",20)(19,"button",21),t.NdJ("click",function(){return t.CHM(e),t.oxw().onReSync()}),t.qZA(),t.TgZ(20,"span",22),t._uU(21),t.qZA()()()()()}if(2&o){const e=t.oxw();t.xp6(4),t.Q6J("selection",e.currentStationRecord)("value",e.stationRecords)("scrollable",!0)("loading",e.loading)("loading",e.loading),t.xp6(9),t.Q6J("disabled",!e.permission.station_record.create),t.xp6(1),t.Q6J("disabled",!e.currentStationRecord||e.currentStationRecord.approval||!e.permission.station_record.edit),t.xp6(1),t.Q6J("ngIf",e.permission.station_record.self),t.xp6(2),t.Q6J("rows",e.itemsPerPage)("totalRecords",e.totalItems)("rowsPerPageOptions",t.DdM(16,ue))("showJumpToPageDropdown",!0)("showPageLinks",!1),t.xp6(4),t.lnq("Hi\u1ec3n th\u1ecb ",(e.currentPage-1)*e.itemsPerPage+1,"-",(e.currentPage-1)*e.itemsPerPage+e.itemsPerPage>e.totalItems?e.totalItems:(e.currentPage-1)*e.itemsPerPage+e.itemsPerPage,"/",e.totalItems,"")}}function me(o,s){1&o&&(t._UZ(0,"i",48),t.TgZ(1,"span",49),t._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),t.qZA())}function ge(o,s){1&o&&(t.TgZ(0,"div",45)(1,"p-messages",46),t.YNc(2,me,3,0,"ng-template",47),t.qZA()())}let fe=(()=>{class o{constructor(e,i,n,r,c,u){this.srHttpService=e,this.messageService=i,this.dialogService=n,this.renderer=r,this.permissionService=c,this.confirmService=u,this.stationRecords=[],this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.loading=!1}ngAfterViewChecked(){this.renderer.setStyle(this.divTable.nativeElement,"height",`  ${this.divBound.nativeElement.offsetHeight-this.divPaginator.nativeElement.offsetHeight}px`)}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth,this.renderer.setStyle(this.divTable.nativeElement,"height",`  ${this.divBound.nativeElement.offsetHeight-this.divPaginator.nativeElement.offsetHeight}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}calcWidth(){let e="";return e=this.windowWidth<450?.99*this.windowWidth+"px":"450px",e}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime)}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(e=>{e&&(this.permission=e,this.fetchListOfStationRecords())}),this.moreCommands=[{label:"Ph\xea duy\u1ec7t",icon:"fa-solid fa-check",disabled:!0,command:()=>{this.approve(!0)}},{label:"H\u1ee7y ph\xea duy\u1ec7t",icon:"fa-solid fa-ban",disabled:!0,command:()=>{this.approve(!1)}},{label:"X\xf3a b\u1ecf",icon:"fa-solid fa-times",disabled:!0,command:()=>{this.onDelete()}}]}fetchListOfStationRecords(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.srHttpService.getList(this.itemsPerPage,this.offset,this.station._id,this.keyword,this.startDate,this.endDate).subscribe({next:e=>{e&&200===e.status&&(this.stationRecords=e.metadata.docs,this.totalItems=e.metadata.totalDocs,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime),this.currentStationRecord=null)},error:e=>{let i;i=e&&e.error&&e.error.message?e.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:i}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",e),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}onClear(){this.keyword=null,this.startDate=null,this.endDate=null,this.rangeTimes=null}onSearch(){this.startDate=this.rangeTimes&&this.rangeTimes.startDate?k().utc(this.rangeTimes.startDate).subtract(7,"hours").format():null,this.endDate=this.rangeTimes&&this.rangeTimes.endDate?k().utc(this.rangeTimes.endDate).subtract(7,"hours").format():null,this.fetchListOfStationRecords()}onAdd(){this.dialogService.open(N,{data:{station:this.station},showHeader:!1,height:"650px",width:this.calcWidth(),contentStyle:{padding:"0",margin:0}}).onClose.subscribe(()=>{this.fetchListOfStationRecords()})}onEdit(){this.dialogService.open(N,{data:{station:this.station,stationRecord:this.currentStationRecord,title:"C\u1eadp nh\u1eadt Nh\u1eadt k\xfd"},showHeader:!1,height:"650px",width:this.calcWidth(),contentStyle:{padding:"0",margin:0}}).onClose.subscribe(()=>{this.fetchListOfStationRecords()})}onDelete(){this.confirmService.confirm({message:`B\u1ea1n c\xf3 mu\u1ed1n x\xf3a Nh\u1eadt k\xfd "${this.convertTime(this.currentStationRecord.created_at)}" kh\xf4ng?`,header:"X\xe1c nh\u1eadn x\xf3a Nh\u1eadt k\xfd",icon:"pi pi-info-circle"}).then(e=>{e&&this.srHttpService.delete(this.currentStationRecord._id).subscribe({next:i=>{i&&200===i.status?(this.fetchListOfStationRecords(),this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 x\xf3a Nh\u1eadt k\xfd th\xe0nh c\xf4ng"})):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Kh\xf4ng t\xecm th\u1ea5y nh\u1eadt k\xfd!"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{let n;n=i&&i.error&&i.error.message?i.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:n}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}).catch(e=>{})}convertTime(e){return f.I.isoToVnTime(e)}onPageChange(e){this.currentPage=e.page+1,this.itemsPerPage=e.rows,this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchListOfStationRecords()}onReSync(){this.fetchListOfStationRecords()}onRowSelect(e){this.moreCommands[0].disabled=!(this.permission.station_record.approve&&this.currentStationRecord&&!this.currentStationRecord.approval),this.moreCommands[1].disabled=!(this.permission.station_record.approve&&this.currentStationRecord&&this.currentStationRecord.approval),this.moreCommands[2].disabled=!(this.permission.station_record.delete&&this.currentStationRecord&&!this.currentStationRecord.approval)}onRowUnselect(e){this.moreCommands[0].disabled=!(this.permission.station_record.approve&&this.currentStationRecord&&!this.currentStationRecord.approval),this.moreCommands[1].disabled=!(this.permission.station_record.approve&&this.currentStationRecord&&this.currentStationRecord.approval),this.moreCommands[2].disabled=!(this.permission.station_record.delete&&this.currentStationRecord&&!this.currentStationRecord.approval)}onViewDetail(){this.dialogService.open(Yt,{data:{stationRecord:this.currentStationRecord},showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}})}approve(e){this.srHttpService.approve(this.currentStationRecord._id,e).subscribe({next:i=>{i&&200===i.status&&(this.fetchListOfStationRecords(),this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:`\u0110\xe3 ${e?"Ph\xea duy\u1ec7t":"H\u1ee7y ph\xea duy\u1ec7t"} nh\u1eadt k\xfd th\xe0nh c\xf4ng!`}))},error:i=>{let n;n=i&&i.error&&i.error.message?i.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:n}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(F),t.Y36(g.ez),t.Y36(h.xA),t.Y36(t.Qsj),t.Y36(S.$),t.Y36(R.I))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-station-record-management"]],viewQuery:function(e,i){if(1&e&&(t.Gf(te,5,t.SBq),t.Gf(ee,5,t.SBq),t.Gf(ie,5,t.SBq),t.Gf(ne,5,t.SBq)),2&e){let n;t.iGM(n=t.CRH())&&(i.divBound=n.first),t.iGM(n=t.CRH())&&(i.divTable=n.first),t.iGM(n=t.CRH())&&(i.divPaginator=n.first),t.iGM(n=t.CRH())&&(i.fileUploader=n.first)}},inputs:{station:"station"},decls:3,vars:2,consts:[["class","absolute top-0 left-0 bottom-0 right-0",3,"resize",4,"ngIf","ngIfElse"],["noPermission",""],[1,"absolute","top-0","left-0","bottom-0","right-0",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full","overflow-auto","p-1"],["divTable",""],["selectionMode","single","styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"selection","value","scrollable","loading","selectionChange","onRowSelect","onRowUnselect"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"absolute","bottom-0","left-0","p-1","w-full","border-top-1","border-gray-300"],["divPaginator",""],[1,"grid","grid-nogutter"],[1,"col-12","md:col-5","flex","align-items-center"],["pButton","","pRipple","","type","button","label","Th\xeam","icon","fa-solid fa-plus",1,"mr-1",3,"disabled","click"],["pButton","","pRipple","","type","button","label","Ch\u1ec9nh s\u1eeda","icon","fa-solid fa-pen",1,"mr-1",3,"disabled","click"],["label","Chi ti\u1ebft","icon","fa-solid fa-wand-sparkles",3,"showTransitionOptions","hideTransitionOptions","model","disabled","onClick",4,"ngIf"],[1,"col-12","md:col-5","flex","align-items-center","justify-content-end"],["styleClass","p-0",3,"rows","totalRecords","rowsPerPageOptions","showJumpToPageDropdown","showPageLinks","onPageChange"],[1,"col-12","md:col-2","flex","align-items-center"],["pButton","","pRipple","","type","button","icon","fa-solid fa-sync",1,"p-button-raised","p-button-text","m-0","p-1",3,"click"],[1,"ml-1"],[1,"p-fluid","grid","formgrid"],[1,"field","col-12","md:col-3","mb-1"],["type","text","pInputText","","placeholder","Ch\u1ecdn kho\u1ea3ng th\u1eddi gian","ngxDaterangepickerMd","",1,"w-full",3,"showDropdowns","locale","showClearButton","timePicker","timePicker24Hour","dateLimit","ngModel","ngModelChange"],["type","text","pInputText","","placeholder","Nh\u1eadp t\u1eeb kh\xf3a",3,"ngModel","ngModelChange"],[1,"field","col-12","md:col-3"],[1,"flex","justify-content-between"],["type","button","pButton","","icon","fa-solid fa-undo","pTooltip","\u0110\u1eb7t l\u1ea1i","tooltipPosition","top",1,"mr-1",3,"click"],["type","button","pButton","","icon","fa-solid fa-search","pTooltip","T\xecm ki\u1ebfm","tooltipPosition","top",1,"mr-1",3,"click"],[2,"width","60px","max-width","60px"],["pSortableColumn","created_at",2,"width","150px","max-width","150px"],["field","created_at"],[2,"min-width","300px"],[2,"max-width","150px"],[2,"width","150px","max-width","150px"],[3,"pSelectableRow"],["alt","","height","80",1,"pointer","shadow-4",3,"src"],["class","m-0 py-1 px-2 text-white border-round-sm","style","background-color: green;",4,"ngIf"],["class","m-0 py-1 px-2 text-white border-round-sm","style","background-color: gray;",4,"ngIf"],[1,"m-0","py-1","px-2","text-white","border-round-sm",2,"background-color","green"],[1,"m-0","py-1","px-2","text-white","border-round-sm",2,"background-color","gray"],[1,"p-fluid","p-2"],["label","Chi ti\u1ebft","icon","fa-solid fa-wand-sparkles",3,"showTransitionOptions","hideTransitionOptions","model","disabled","onClick"],[1,"flex","align-items-center","justify-content-center"],["severity","error"],["pTemplate",""],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(e,i){if(1&e&&(t.YNc(0,he,22,17,"div",0),t.YNc(1,ge,3,0,"ng-template",null,1,t.W1O)),2&e){const n=t.MAs(2);t.Q6J("ngIf",i.permission.station_record.self)("ngIfElse",n)}},directives:[l.O5,_.iA,g.jx,Kt.SP,p.Fj,Z.o,p.JJ,p.On,C.Hq,w.u,_.lQ,_.fz,_.Ei,b.H,J.a,Y.D,D.V],styles:[""]}),o})();const _e=["divBound"],ve=["divHeader"],Ce=["divTable"];function be(o,s){if(1&o&&t._UZ(0,"app-station-info",14),2&o){const e=t.oxw(2);t.Q6J("station",e.station)}}function ye(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"app-station-config",15),t.NdJ("changeInfoEvent",function(){return t.CHM(e),t.oxw(2).fetchInfo()}),t.qZA()}if(2&o){const e=t.oxw(2);t.Q6J("station",e.station)}}function xe(o,s){if(1&o&&t._UZ(0,"app-station-record-management",14),2&o){const e=t.oxw(2);t.Q6J("station",e.station)}}function Te(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",2,3),t.NdJ("resize",function(){return t.CHM(e),t.oxw().onWindowResize()},!1,t.Jf7),t.TgZ(2,"div",4,5)(4,"div",6)(5,"span",7),t._uU(6),t.qZA(),t.TgZ(7,"button",8),t.NdJ("click",function(){return t.CHM(e),t.oxw().onDestroy()}),t.qZA()(),t._UZ(8,"p-tabMenu",9),t.qZA(),t.TgZ(9,"div",10,11),t.YNc(11,be,1,1,"app-station-info",12),t.YNc(12,ye,1,1,"app-station-config",13),t.YNc(13,xe,1,1,"app-station-record-management",12),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(6),t.Oqu(e.title),t.xp6(2),t.Q6J("model",e.tabs)("activeItem",e.activeTab),t.xp6(3),t.Q6J("ngIf",1==e.tabIndex),t.xp6(1),t.Q6J("ngIf",2==e.tabIndex),t.xp6(1),t.Q6J("ngIf",3==e.tabIndex)}}function Se(o,s){1&o&&(t._UZ(0,"i",18),t.TgZ(1,"span",19),t._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),t.qZA())}function Ee(o,s){1&o&&(t.TgZ(0,"p-messages",16),t.YNc(1,Se,3,0,"ng-template",17),t.qZA())}let Ze=(()=>{class o{constructor(e,i,n,r,c,u){this.renderer=e,this.permissionService=i,this.ref=n,this.config=r,this.sHttpService=c,this.messageService=u,this.tabIndex=1,this.title="Chi ti\u1ebft tr\u1ea1m",this.has_change=!1}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe()}setStyleDiv(){this.renderer.setStyle(this.divTable.nativeElement,"height",`  ${this.divBound.nativeElement.offsetHeight-this.divHeader.nativeElement.offsetHeight}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(e=>{e&&(this.permission=e,this.config.data.station&&(this.station=this.config.data.station),this.initForm(),this.fetchInfo())})}initForm(){this.tabs=[{label:"Th\xf4ng tin chung",command:()=>{this.tabIndex=1}},{label:"C\u1ea5u h\xecnh",command:()=>{this.tabIndex=2}},{label:"Nh\u1eadt k\xfd",command:()=>{this.tabIndex=3}}],this.activeTab=this.tabs[0],this.tabIndex=1}onDestroy(){this.has_change?this.ref.close("change"):this.ref.destroy()}fetchInfo(){this.sHttpService.getDetail(this.station._id).subscribe({next:e=>{e&&200===e.status?(this.station=e.metadata,this.has_change=!0):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Kh\xf4ng t\xecm th\u1ea5y tr\u1ea1m"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",e.message))},error:e=>{let i;i=e&&e.error&&e.error.message?e.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:i}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",e)}})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(t.Qsj),t.Y36(S.$),t.Y36(h.E7),t.Y36(h.S),t.Y36(T.P),t.Y36(g.ez))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-station-detail"]],viewQuery:function(e,i){if(1&e&&(t.Gf(_e,5,t.SBq),t.Gf(ve,5,t.SBq),t.Gf(Ce,5,t.SBq)),2&e){let n;t.iGM(n=t.CRH())&&(i.divBound=n.first),t.iGM(n=t.CRH())&&(i.divHeader=n.first),t.iGM(n=t.CRH())&&(i.divTable=n.first)}},decls:3,vars:2,consts:[["class","absolute top-0 left-0 bottom-0 right-0",3,"resize",4,"ngIf","ngIfElse"],["noPermission",""],[1,"absolute","top-0","left-0","bottom-0","right-0",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["divHeader",""],[1,"flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","text-xl","font-bold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[3,"model","activeItem"],[1,"absolute","bottom-0","left-0","w-full"],["divTable",""],[3,"station",4,"ngIf"],[3,"station","changeInfoEvent",4,"ngIf"],[3,"station"],[3,"station","changeInfoEvent"],["severity","error"],["pTemplate",""],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(e,i){if(1&e&&(t.YNc(0,Te,14,6,"div",0),t.YNc(1,Ee,2,0,"ng-template",null,1,t.W1O)),2&e){const n=t.MAs(2);t.Q6J("ngIf",i.permission.project.self)("ngIfElse",n)}},directives:[l.O5,C.Hq,b.H,at.d,ct,Ot,fe,D.V,g.jx],styles:[""]}),o})();var Ae=a(7658);const we=["divBound"],De=["divTable"],Me=["divPaginator"];function Xe(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",28)(1,"div",29)(2,"div",30)(3,"input",31),t.NdJ("ngModelChange",function(n){return t.CHM(e),t.oxw(2).project_name=n}),t.qZA(),t.TgZ(4,"button",32),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).onPickProject()}),t.qZA()()(),t.TgZ(5,"div",29)(6,"input",33),t.NdJ("ngModelChange",function(n){return t.CHM(e),t.oxw(2).name=n}),t.qZA()(),t.TgZ(7,"div",29)(8,"input",34),t.NdJ("ngModelChange",function(n){return t.CHM(e),t.oxw(2).code=n}),t.qZA()(),t.TgZ(9,"div",35)(10,"div",36)(11,"span")(12,"button",37),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).onClear()}),t.qZA(),t.TgZ(13,"button",38),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).fetchListOfStations()}),t.qZA()()()()()}if(2&o){const e=t.oxw(2);t.xp6(3),t.Q6J("ngModel",e.project_name),t.xp6(3),t.Q6J("ngModel",e.name),t.xp6(2),t.Q6J("ngModel",e.code)}}function ke(o,s){1&o&&(t.TgZ(0,"tr")(1,"th",39),t._uU(2,"#"),t.qZA(),t.TgZ(3,"th",39),t._uU(4,"TT"),t.qZA(),t.TgZ(5,"th",40),t._uU(6,"T\xean "),t._UZ(7,"p-sortIcon",41),t.qZA(),t.TgZ(8,"th",42),t._uU(9,"M\xe3"),t.qZA(),t.TgZ(10,"th",43),t._uU(11,"Thi\u1ebft b\u1ecb"),t.qZA(),t.TgZ(12,"th",44),t._uU(13,"K\xedch ho\u1ea1t"),t.qZA(),t.TgZ(14,"th",44),t._uU(15,"C\u1ea5u h\xecnh"),t.qZA(),t.TgZ(16,"th",43),t._uU(17,"C\xf4ng tr\xecnh"),t.qZA(),t.TgZ(18,"th",45),t._uU(19,"Th\u1eddi gian t\u1ea1o "),t._UZ(20,"p-sortIcon",46),t.qZA(),t.TgZ(21,"th",47),t._uU(22,"C\u1eadp nh\u1eadt "),t._UZ(23,"p-sortIcon",48),t.qZA()())}function Re(o,s){1&o&&t._UZ(0,"img",55)}function Pe(o,s){1&o&&t._UZ(0,"img",56)}function Be(o,s){1&o&&t._UZ(0,"i",57)}const Oe=function(o){return{"background-color":o}};function qe(o,s){if(1&o&&(t.TgZ(0,"tr",49)(1,"td",39),t._uU(2),t.qZA(),t.TgZ(3,"td",39),t.YNc(4,Re,1,0,"img",50),t.YNc(5,Pe,1,0,"img",51),t.qZA(),t.TgZ(6,"td",43),t._uU(7),t.qZA(),t.TgZ(8,"td",42),t._uU(9),t.qZA(),t.TgZ(10,"td",43),t._uU(11),t.qZA(),t.TgZ(12,"td",52),t.YNc(13,Be,1,0,"i",53),t.qZA(),t.TgZ(14,"td",44)(15,"span",54),t._uU(16),t.qZA()(),t.TgZ(17,"td",43),t._uU(18),t.qZA(),t.TgZ(19,"td",43),t._uU(20),t.qZA(),t.TgZ(21,"td",43),t._uU(22),t.qZA()()),2&o){const e=s.$implicit,i=s.rowIndex,n=t.oxw(2);t.Q6J("pSelectableRow",e),t.xp6(2),t.Oqu((n.currentPage-1)*n.itemsPerPage+1+i),t.xp6(2),t.Q6J("ngIf",e.status),t.xp6(1),t.Q6J("ngIf",!e.status),t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.code),t.xp6(2),t.Oqu(n.getDeviceType(e.device_type)),t.xp6(2),t.Q6J("ngIf",e.activated),t.xp6(2),t.Q6J("ngStyle",t.VKq(13,Oe,0===e.cfg_status?"red":1===e.cfg_status?"orange":2===e.cfg_status?"green":"lightgray")),t.xp6(1),t.Oqu(n.getCfgStatus(e.cfg_status)),t.xp6(2),t.Oqu(null==e.project?null:e.project.name),t.xp6(2),t.Oqu(n.convertTime(e.created_at)),t.xp6(2),t.Oqu(n.convertTime(e.updated_at))}}function He(o,s){1&o&&(t.TgZ(0,"div",58),t._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. "),t.qZA())}function Ie(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"p-splitButton",59),t.NdJ("onClick",function(){return t.CHM(e),t.oxw(2).onViewDetail()}),t.qZA()}if(2&o){const e=t.oxw(2);t.Q6J("showTransitionOptions","200ms")("hideTransitionOptions","200ms")("model",e.moreCommands)("disabled",!e.currentStation)}}const Ue=function(){return[15,20,30,50]};function Le(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",2,3),t.NdJ("resize",function(){return t.CHM(e),t.oxw().onWindowResize()},!1,t.Jf7),t.TgZ(2,"div",4),t._UZ(3,"p-breadcrumb",5),t.TgZ(4,"div",6)(5,"h3",7),t._UZ(6,"i",8),t._uU(7,"Danh s\xe1ch tr\u1ea1m "),t.qZA()(),t.TgZ(8,"div",9,10)(10,"p-table",11),t.NdJ("selectionChange",function(n){return t.CHM(e),t.oxw().currentStation=n})("onRowSelect",function(n){return t.CHM(e),t.oxw().onRowSelect(n)})("onRowUnselect",function(n){return t.CHM(e),t.oxw().onRowUnselect(n)}),t.YNc(11,Xe,14,3,"ng-template",12),t.YNc(12,ke,24,0,"ng-template",13),t.YNc(13,qe,23,15,"ng-template",14),t.YNc(14,He,2,0,"ng-template",15),t.qZA()()(),t.TgZ(15,"div",16,17)(17,"div",18)(18,"div",19)(19,"button",20),t.NdJ("click",function(){return t.CHM(e),t.oxw().onAdd()}),t.qZA(),t.TgZ(20,"button",21),t.NdJ("click",function(){return t.CHM(e),t.oxw().onEdit()}),t.qZA(),t.YNc(21,Ie,1,4,"p-splitButton",22),t.qZA(),t.TgZ(22,"div",23)(23,"p-paginator",24),t.NdJ("onPageChange",function(n){return t.CHM(e),t.oxw().onPageChange(n)}),t.qZA()(),t.TgZ(24,"div",25)(25,"button",26),t.NdJ("click",function(){return t.CHM(e),t.oxw().onReSync()}),t.qZA(),t.TgZ(26,"span",27),t._uU(27),t.qZA()()()()()}if(2&o){const e=t.oxw();t.xp6(3),t.Q6J("model",e.pathLinks)("home",e.homeLink),t.xp6(7),t.Q6J("selection",e.currentStation)("value",e.stations)("scrollable",!0)("loading",e.loading),t.xp6(9),t.Q6J("disabled",!e.permission.station.create),t.xp6(1),t.Q6J("disabled",!e.currentStation||!e.permission.station.edit),t.xp6(1),t.Q6J("ngIf",e.permission.station.self),t.xp6(2),t.Q6J("rows",e.itemsPerPage)("totalRecords",e.totalItems)("rowsPerPageOptions",t.DdM(17,Ue))("showJumpToPageDropdown",!0)("showPageLinks",!1),t.xp6(4),t.lnq("Hi\u1ec3n th\u1ecb ",(e.currentPage-1)*e.itemsPerPage+1,"-",(e.currentPage-1)*e.itemsPerPage+e.itemsPerPage>e.totalItems?e.totalItems:(e.currentPage-1)*e.itemsPerPage+e.itemsPerPage,"/",e.totalItems,"")}}function Fe(o,s){1&o&&(t._UZ(0,"i",67),t.TgZ(1,"span",68),t._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),t.qZA())}function Ne(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",60)(1,"p-messages",61),t.YNc(2,Fe,3,0,"ng-template",62),t.qZA()(),t.TgZ(3,"div",63)(4,"div",64),t.NdJ("click",function(){return t.CHM(e),t.oxw().onGoBackHome()}),t._UZ(5,"span",65),t.TgZ(6,"span",66),t._uU(7,"Quay l\u1ea1i Trang ch\u1ee7"),t.qZA()()()}}const Je=[{path:"",component:(()=>{class o{constructor(e,i,n,r,c,u,d){this.sHttpService=e,this.messageService=i,this.renderer=n,this.dialogService=r,this.permissionService=c,this.router=u,this.confirmService=d,this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.stations=[],this.loading=!1,this.deviceTypeOption=v.o.deviceTypeOption}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime),this.loadTimer&&clearInterval(this.loadTimer)}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth,this.renderer.setStyle(this.divTable.nativeElement,"height",`  ${this.divBound.nativeElement.offsetHeight-this.divPaginator.nativeElement.offsetHeight-62}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}calcWidth(){let e="";return e=this.windowWidth<450?.99*this.windowWidth+"px":"450px",e}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(e=>{e&&(this.permission=e,this.initForm(),this.fetchListOfStations(),this.autoReload())})}initForm(){this.pathLinks=[{label:"Qu\u1ea3n l\xfd",disabled:!0},{label:"Tr\u1ea1m",disabled:!0}],this.homeLink={icon:"fa-solid fa-home",routerLink:"/"},this.moreCommands=[{label:"K\xedch ho\u1ea1t",icon:"fa-solid fa-check",disabled:!0,command:()=>{this.onChangeActive(!0)}},{label:"H\u1ee7y k\xedch ho\u1ea1t",icon:"fa-solid fa-ban",disabled:!0,command:()=>{this.onChangeActive(!1)}},{label:"X\xf3a b\u1ecf",icon:"fa-solid fa-minus",disabled:!0,command:()=>{this.onDelete()}}]}onPickProject(){this.dialogService.open(O.A,{showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(i=>{i&&(this.project_name=i.name,this.project_id=i._id)})}onClear(){this.name=null,this.code=null,this.project_id=null,this.project_name=null}fetchListOfStations(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.sHttpService.getList(this.name,this.code,this.project_id,null,this.itemsPerPage,this.offset).subscribe({next:e=>{e&&200===e.status&&(this.stations=e.metadata.docs,this.totalItems=e.metadata.totalDocs,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime),this.currentStation=null)},error:e=>{let i;i=e&&e.error&&e.error.message?e.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:i}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",e),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}onPageChange(e){this.currentPage=e.page+1,this.itemsPerPage=e.rows,this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchListOfStations()}onReSync(){this.fetchListOfStations()}onRowSelect(e){this.moreCommands[0].disabled=!(this.permission.station.active&&this.currentStation&&!this.currentStation.activated),this.moreCommands[1].disabled=!(this.permission.station.active&&this.currentStation&&this.currentStation.activated),this.moreCommands[2].disabled=!this.permission.station.delete||!this.currentStation}onRowUnselect(e){this.moreCommands[0].disabled=!(this.permission.station.active&&this.currentStation&&!this.currentStation.activated),this.moreCommands[1].disabled=!(this.permission.station.active&&this.currentStation&&this.currentStation.activated),this.moreCommands[2].disabled=!this.permission.station.delete||!this.currentStation}onAdd(){this.dialogService.open(I,{showHeader:!1,height:"750px",width:this.calcWidth(),contentStyle:{padding:"0",margin:0}}).onClose.subscribe(()=>{this.fetchListOfStations()})}onEdit(){this.dialogService.open(I,{data:{station:this.currentStation,title:"C\u1eadp nh\u1eadt tr\u1ea1m"},showHeader:!1,height:"750px",width:this.calcWidth(),contentStyle:{padding:"0",margin:0}}).onClose.subscribe(()=>{this.fetchListOfStations()})}onDelete(){this.confirmService.confirm({message:`B\u1ea1n c\xf3 mu\u1ed1n x\xf3a tr\u1ea1m"${this.currentStation.name}" kh\xf4ng?`,header:"X\xe1c nh\u1eadn x\xf3a tr\u1ea1m",icon:"pi pi-info-circle"}).then(e=>{e&&this.sHttpService.delete(this.currentStation._id).subscribe({next:i=>{i&&200===i.status?(this.fetchListOfStations(),this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 x\xf3a tr\u1ea1m th\xe0nh c\xf4ng"})):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Kh\xf4ng t\xecm th\u1ea5y tr\u1ea1m"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{let n;n=i&&i.error&&i.error.message?i.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:n}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}).catch(e=>{})}onViewDetail(){this.dialogService.open(Ze,{data:{station:this.currentStation},showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(i=>{"change"==i&&this.fetchListOfStations()})}convertTime(e){return f.I.isoToVnTime(e)}onGoBackHome(){this.router.navigate(["/"])}getDeviceType(e){let i=this.deviceTypeOption.find(n=>n.value==e);return i?i.name:e}onChangeActive(e){this.sHttpService.active(this.currentStation._id,e).subscribe({next:i=>{i&&200===i.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:`\u0110\xe3 ${e?"k\xedch ho\u1ea1t":"h\u1ee7y k\xedch ho\u1ea1t"} tr\u1ea1m th\xe0nh c\xf4ng`}),this.fetchListOfStations()):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Kh\xf4ng t\xecm th\u1ea5y tr\u1ea1m"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{let n;n=i&&i.error&&i.error.message?i.error.message:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i!",this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:n}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}getCfgStatus(e){let i="N/A";return 0==e?i="M\u1edbi":1==e?i="\u0110ang t\u1ea3i":2==e&&(i="\u0110\xe3 t\u1ea3i"),i}autoReload(){this.loadTimer=setInterval(()=>{this.fetchListOfStations()},1e3*v.o.TIME_UPDATE)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(T.P),t.Y36(g.ez),t.Y36(t.Qsj),t.Y36(h.xA),t.Y36(S.$),t.Y36(m.F0),t.Y36(R.I))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-station-management"]],viewQuery:function(e,i){if(1&e&&(t.Gf(we,5,t.SBq),t.Gf(De,5,t.SBq),t.Gf(Me,5,t.SBq)),2&e){let n;t.iGM(n=t.CRH())&&(i.divBound=n.first),t.iGM(n=t.CRH())&&(i.divTable=n.first),t.iGM(n=t.CRH())&&(i.divPaginator=n.first)}},decls:3,vars:2,consts:[["class","relative h-full w-full",3,"resize",4,"ngIf","ngIfElse"],["noPermission",""],[1,"relative","h-full","w-full",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["styleClass","text-sm p-1",3,"model","home"],[1,"flex","align-items-center"],[1,"text-blue-700","m-0","px-2","pt-2","pb-0"],[1,"fa-solid","fa-list","mr-2"],[1,"page-content","mt-1"],["divTable",""],["selectionMode","single","styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"selection","value","scrollable","loading","selectionChange","onRowSelect","onRowUnselect"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"absolute","bottom-0","left-0","p-1","w-full","border-top-1","border-gray-300"],["divPaginator",""],[1,"grid","grid-nogutter"],[1,"col-12","md:col-5","flex","align-items-center"],["pButton","","pRipple","","type","button","label","Th\xeam","icon","fa-solid fa-plus",1,"mr-1",3,"disabled","click"],["pButton","","pRipple","","type","button","label","Ch\u1ec9nh s\u1eeda","icon","fa-solid fa-pen",1,"mr-1",3,"disabled","click"],["label","Chi ti\u1ebft","icon","fa-solid fa-wand-sparkles",3,"showTransitionOptions","hideTransitionOptions","model","disabled","onClick",4,"ngIf"],[1,"col-12","md:col-5","flex","align-items-center","justify-content-end"],["styleClass","p-0",3,"rows","totalRecords","rowsPerPageOptions","showJumpToPageDropdown","showPageLinks","onPageChange"],[1,"col-12","md:col-2","flex","align-items-center"],["pButton","","pRipple","","type","button","icon","fa-solid fa-sync",1,"p-button-raised","p-button-text","m-0","p-1",3,"click"],[1,"ml-1"],[1,"p-fluid","grid","formgrid"],[1,"field","col-12","md:col-3","mb-1"],[1,"p-inputgroup"],["type","text","pInputText","","placeholder","Ch\u1ecdn c\xf4ng tr\xecnh","disabled","",3,"ngModel","ngModelChange"],["type","button","pButton","","pRipple","","icon","pi pi-ellipsis-h",3,"click"],["type","text","pInputText","","placeholder","Nh\u1eadp t\xean tr\u1ea1m",3,"ngModel","ngModelChange"],["type","text","pInputText","","placeholder","Nh\u1eadp m\xe3 tr\u1ea1m (MAC)",3,"ngModel","ngModelChange"],[1,"field","col-12","md:col-3"],[1,"flex","justify-content-between"],["type","button","pButton","","icon","fa-solid fa-undo","pTooltip","\u0110\u1eb7t l\u1ea1i","tooltipPosition","top",1,"mr-1",3,"click"],["type","button","pButton","","icon","fa-solid fa-search","pTooltip","T\xecm ki\u1ebfm","tooltipPosition","top",1,"mr-1",3,"click"],[2,"width","60px","max-width","60px"],["pSortableColumn","name",2,"min-width","200px"],["field","name"],[2,"min-width","50px"],[2,"min-width","200px"],[2,"min-width","100px"],["pSortableColumn","created_at",2,"min-width","200px"],["field","created_at"],["pSortableColumn","updated_at",2,"min-width","200px"],["field","updated_at"],[3,"pSelectableRow"],["height","18","src","assets/g.png","alt","Online",4,"ngIf"],["height","18","src","assets/b.png","alt","offline",4,"ngIf"],[1,"text-green-500",2,"min-width","100px"],["class","pi pi-check-circle",4,"ngIf"],[1,"m-0","py-1","px-2","text-white","border-round-sm",3,"ngStyle"],["height","18","src","assets/g.png","alt","Online"],["height","18","src","assets/b.png","alt","offline"],[1,"pi","pi-check-circle"],[1,"p-fluid","p-2"],["label","Chi ti\u1ebft","icon","fa-solid fa-wand-sparkles",3,"showTransitionOptions","hideTransitionOptions","model","disabled","onClick"],[1,"flex","align-items-center","justify-content-center"],["severity","error"],["pTemplate",""],[1,"flex","align-items-center","justify-content-center","cursor-pointer"],["pRipple","",1,"flex","align-items-center","justify-content-center","w-full","h-4rem","max-w-20rem","bg-blue-500","border-round-md","shadow-8","text-white","font-bold",3,"click"],[1,"fa-solid","fa-home"],[1,"text-center","text-xl","mx-2"],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(e,i){if(1&e&&(t.YNc(0,Le,28,18,"div",0),t.YNc(1,Ne,8,0,"ng-template",null,1,t.W1O)),2&e){const n=t.MAs(2);t.Q6J("ngIf",i.permission.station.self)("ngIfElse",n)}},directives:[l.O5,Ae.a,_.iA,g.jx,p.Fj,Z.o,p.JJ,p.On,C.Hq,b.H,w.u,_.lQ,_.fz,_.Ei,l.PC,J.a,Y.D,D.V],styles:[""]}),o})()}];let Ye=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[m.Bz.forChild(Je)],m.Bz]}),o})();var Qe=a(8910);let Ge=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[l.ez,Ye,Qe.m]]}),o})()},2491:()=>{!function(){function B(a,l){this.title=a.title,this.stateName=a.stateName?a.stateName:"unnamed-state",this.icon=L.DomUtil.create("span",""),L.DomUtil.addClass(this.icon,"button-state state-"+this.stateName.replace(/(^\s*|\s*$)/g,"")),this.icon.innerHTML=function E(a){var l;return a.match(/[&;=<>"']/)?l=a:(a=a.replace(/(^\s*|\s*$)/g,""),l=L.DomUtil.create("span",""),0===a.indexOf("fa-")?L.DomUtil.addClass(l,"fa "+a):0===a.indexOf("glyphicon-")?L.DomUtil.addClass(l,"glyphicon "+a):L.DomUtil.addClass(l,a),l=l.outerHTML),l}(a.icon),this.onClick=L.Util.bind(a.onClick?a.onClick:function(){},l)}L.Control.EasyBar=L.Control.extend({options:{position:"topleft",id:null,leafletClasses:!0},initialize:function(a,l){l&&L.Util.setOptions(this,l),this._buildContainer(),this._buttons=[];for(var m=0;m<a.length;m++)a[m]._bar=this,a[m]._container=a[m].button,this._buttons.push(a[m]),this.container.appendChild(a[m].button)},_buildContainer:function(){this._container=this.container=L.DomUtil.create("div",""),this.options.leafletClasses&&L.DomUtil.addClass(this.container,"leaflet-bar easy-button-container leaflet-control"),this.options.id&&(this.container.id=this.options.id)},enable:function(){return L.DomUtil.addClass(this.container,"enabled"),L.DomUtil.removeClass(this.container,"disabled"),this.container.setAttribute("aria-hidden","false"),this},disable:function(){return L.DomUtil.addClass(this.container,"disabled"),L.DomUtil.removeClass(this.container,"enabled"),this.container.setAttribute("aria-hidden","true"),this},onAdd:function(){return this.container},addTo:function(a){this._map=a;for(var l=0;l<this._buttons.length;l++)this._buttons[l]._map=a;var m=this._container=this.onAdd(a),t=this.getPosition(),f=a._controlCorners[t];return L.DomUtil.addClass(m,"leaflet-control"),-1!==t.indexOf("bottom")?f.insertBefore(m,f.firstChild):f.appendChild(m),this}}),L.easyBar=function(){for(var a=[L.Control.EasyBar],l=0;l<arguments.length;l++)a.push(arguments[l]);return new(Function.prototype.bind.apply(L.Control.EasyBar,a))},L.Control.EasyButton=L.Control.extend({options:{position:"topleft",id:null,type:"replace",states:[],leafletClasses:!0,tagName:"button"},initialize:function(a,l,m,t){this.options.states=[],null!=t&&(this.options.id=t),this.storage={},"object"==typeof arguments[arguments.length-1]&&L.Util.setOptions(this,arguments[arguments.length-1]),0===this.options.states.length&&"string"==typeof a&&"function"==typeof l&&this.options.states.push({icon:a,onClick:l,title:"string"==typeof m?m:""}),this._states=[];for(var f=0;f<this.options.states.length;f++)this._states.push(new B(this.options.states[f],this));this._buildButton(),this._activateState(this._states[0])},_buildButton:function(){if(this.button=L.DomUtil.create(this.options.tagName,""),"button"===this.options.tagName&&this.button.setAttribute("type","button"),this.options.id&&(this.button.id=this.options.id),this.options.leafletClasses&&L.DomUtil.addClass(this.button,"easy-button-button leaflet-bar-part leaflet-interactive"),L.DomEvent.addListener(this.button,"dblclick",L.DomEvent.stop),L.DomEvent.addListener(this.button,"mousedown",L.DomEvent.stop),L.DomEvent.addListener(this.button,"mouseup",L.DomEvent.stop),L.DomEvent.addListener(this.button,"click",function(l){L.DomEvent.stop(l),this._currentState.onClick(this,this._map?this._map:null),this._map&&this._map.getContainer().focus()},this),"replace"==this.options.type)this.button.appendChild(this._currentState.icon);else for(var a=0;a<this._states.length;a++)this.button.appendChild(this._states[a].icon)},_currentState:{stateName:"unnamed",icon:document.createElement("span")},_states:null,state:function(a){return 0===arguments.length?this._currentState.stateName:("string"==typeof a?this._activateStateNamed(a):"number"==typeof a&&this._activateState(this._states[a]),this)},_activateStateNamed:function(a){for(var l=0;l<this._states.length;l++)this._states[l].stateName==a&&this._activateState(this._states[l])},_activateState:function(a){if(a!==this._currentState){"replace"==this.options.type&&(this.button.appendChild(a.icon),this.button.removeChild(this._currentState.icon)),a.title?this.button.title=a.title:this.button.removeAttribute("title");for(var l=0;l<this._states.length;l++)L.DomUtil.removeClass(this._states[l].icon,this._currentState.stateName+"-active"),L.DomUtil.addClass(this._states[l].icon,a.stateName+"-active");L.DomUtil.removeClass(this.button,this._currentState.stateName+"-active"),L.DomUtil.addClass(this.button,a.stateName+"-active"),this._currentState=a}},enable:function(){return L.DomUtil.addClass(this.button,"enabled"),L.DomUtil.removeClass(this.button,"disabled"),this.button.setAttribute("aria-hidden","false"),this},disable:function(){return L.DomUtil.addClass(this.button,"disabled"),L.DomUtil.removeClass(this.button,"enabled"),this.button.setAttribute("aria-hidden","true"),this},onAdd:function(a){var l=L.easyBar([this],{position:this.options.position,leafletClasses:this.options.leafletClasses});return this._anonymousBar=l,this._container=l.container,this._anonymousBar.container},removeFrom:function(a){return this._map===a&&this.remove(),this}}),L.easyButton=function(){var a=Array.prototype.concat.apply([L.Control.EasyButton],arguments);return new(Function.prototype.bind.apply(L.Control.EasyButton,a))}}()}}]);